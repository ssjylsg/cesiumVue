window.NPGIS3D=window.NPGIS3D||{},window.NPMAP3D=window.NPGIS3D,window.NPGIS3D.VesionNumber="V1.3.0",NPGIS3D.getScriptLocation=function(){function e(e){for(var t,i,o=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),r=document.getElementsByTagName("script"),n="",a=0,s=r.length;a<s;a++)if(t=r[a].getAttribute("src"),t&&(i=t.match(o))){n=i[1];break}return n}var t=e("NPGIS3D.js");return window.CESIUM_BASE_URL=t+"lib/Cesium/",console.log(t),t},NPGIS3D.addCSSFiles=function(e){var t=NPGIS3D.getScriptLocation();if(e&&!(e.length<=0)){for(var i=(document.getElementsByTagName("HEAD").item(0),[]),o=0,r=e.length;o<r;o++)i.push("<link type='text/css' rel='stylesheet' href = '"+(""===t?e[o]:t+"/"+e[o])+"'/> ");i.length>0&&document.write(i.join(""))}},NPGIS3D.addJSFiles=function(e){if(e&&!(e.length<=0)){for(var t=NPGIS3D.getScriptLocation(),i=[],o=(document.getElementsByTagName("HEAD").item(0),0),r=e.length;o<r;o++)i.push("<script type='text/javascript' src='"+(""===t?e[o]:t+"/"+e[o])+"'></script>");i.length>0&&document.write(i.join(""))}},function(){var e=["lib/Cesium/Widgets/widgets.css","css/NPGIS3D.css"],t=["lib/Cesium/Cesium.js","lib/Cesium/DrawHelper/DrawHelper.js","lib/Cesium/CesiumHeatmap.js"];NPGIS3D.addCSSFiles(e),NPGIS3D.addJSFiles(t)}(),NPGIS3D.StripeOrientation={HORIZONTAL:0,VERTICAL:1},NPGIS3D.CornerType={ROUNDED:0,MITERED:1,BEVELED:2},NPGIS3D.Static={},NPGIS3D.Static.HorizontalOrigin={CENTER:0,LEFT:1,RIGHT:-1},NPGIS3D.Static.LabelStyle={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2},NPGIS3D.Static.VerticalOrigin={CENTER:0,BOTTOM:1,TOP:-1},NPGIS3D.Static.HeightReference={NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2},NPGIS3D.Building={},NPGIS3D.inherits=function(e,t){var i=t.prototype,o=e.prototype;for(var r in i)o[r]=i[r];o.uber=i,e.prototype.constructor=e},NPGIS3D.nullFunction=function(){},NPGIS3D.global=Function("return this")(),NPGIS3D.basemap=void 0,NPGIS3D.MAP3D=function(e,t){return NPGIS3D.VerticalOrigin=Cesium.VerticalOrigin,NPGIS3D.HorizontalOrigin=Cesium.HorizontalOrigin,NPGIS3D.Color=Cesium.Color,NPGIS3D.Size=Cesium.Cartesian2,NPGIS3D.Size3D=Cesium.Cartesian3,NPGIS3D.LabelStyle=Cesium.LabelStyle,NPGIS3D.HeightReference=Cesium.HeightReference,NPGIS3D.NPUtil.webglSupport()?(Cesium.Camera.DEFAULT_VIEW_RECTANGLE=new Cesium.Rectangle((-3.141592653589793),(-1.5707963267948966),3.141592653589793,1.5707963267948966),t=NPGIS3D.NPUtil.extend(t,{scene3DOnly:!0,baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,infoBox:!1}),this._orginPosition=new Cesium.Cartesian3((-7032023.211687667),24311175.076032314,19651885.224244125),this.viewer=new Cesium.Viewer(e,t),this.viewer._cesiumWidget._creditContainer.style.display="none",this.events={},this.thematicMap=new NPGIS3D.HashMap,this.modelLayers={},this._setInputAction(),void this.viewer.camera.flyTo({destination:this._orginPosition,duration:0})):void alert("浏览器不支持 WebGL!")},NPGIS3D.MAP3D.prototype._loadDefaultBaseLayer=function(){this.viewer.imageryLayers.removeAll();var e,t=NPGIS3D.NPUtil.getHost(),i=new NPGIS3D.Layer.GaoDeLayer(t+"lib/Cesium/Assets/basemap/{z}/{x}/{y}.jpg","AMAP_BASEMAP_DEFAULT",{maximumLevel:3}),o=i.imageryLayers,r=0,n=o.length;for(r;r<n;r++)e=o[r],e._isBaseLayer=!0,this.viewer.imageryLayers.add(e);NPGIS3D.basemap=i._baseMapType},NPGIS3D.MAP3D.prototype.addEventLinsener=function(e,t){this.events[e]=t},NPGIS3D.MAP3D.prototype.removeEventLinsener=function(e){this.events[e]&&delete this.events[e]},NPGIS3D.MAP3D.prototype.addLayer=function(e){!e.imageryLayers||e.imageryLayers.length<1||(this.viewer.imageryLayers.add(e.imageryLayers[0]),2===e.imageryLayers.length&&this.viewer.imageryLayers.add(e.imageryLayers[1]),NPGIS3D.basemap=e._baseMapType,this.thematicMap.put(e.name,e))},NPGIS3D.MAP3D.prototype.addModelLayer=function(e,t){var i=this.viewer.scene.addS3MTilesLayerByScp(e.url,{name:e.name}),o=this;Cesium.when(i,function(){e.obj=o.viewer.scene.layers.find(e.name),e.opts&&e.opts.enableSelect===!1&&e.setEnableSelect(!1),t&&t instanceof Function&&t()}),this.modelLayers[e.name]=e},NPGIS3D.MAP3D.prototype.addModelLayers=function(e,t){for(var i=[],o=0;o<e.length;o++){var r=this.viewer.scene.addS3MTilesLayerByScp(e[o].url,{name:e[o].name});i.push(r),this.modelLayers[e[o].name]=e[o]}var n=this;Cesium.when.all(i,function(){for(var i=0;i<e.length;i++)e[i].obj=n.viewer.scene.layers.find(e[i].name),e[i].opts&&e[i].opts.enableSelect===!1&&e[i].setEnableSelect(!1);t&&t instanceof Function&&t()})},NPGIS3D.MAP3D.prototype.removeModelLayer=function(e){e&&e.obj&&(this.viewer.scene.layers.remove(e.name),this.modelLayers[e.name]=null,delete this.modelLayers[e.name])},NPGIS3D.MAP3D.prototype.addLayers=function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},NPGIS3D.MAP3D.prototype.addTerrainLayer=function(e){e instanceof NPGIS3D.Layer.TerrainLayer&&(this.viewer.terrainProvider=e._layer)},NPGIS3D.MAP3D.prototype.removeTerrainLayer=function(){this.viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider},NPGIS3D.MAP3D.prototype.getLayerByName=function(e){var t;return this.thematicMap.containsKey(e)&&(t=this.thematicMap.get(e)),t},NPGIS3D.MAP3D.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);Cesium.defined(t)&&(this.viewer.imageryLayers.remove(t.imageryLayers[0]),this.thematicMap.removeByKey(e),this._setDefaultState())},NPGIS3D.MAP3D.prototype.getAllLayers=function(){return this.thematicMap.values()},NPGIS3D.MAP3D.prototype.flyTo=function(e,t,i){if(arguments.length<2)throw new NPGIS3D.DeveloperError("MAP3D","flyTo() 参数 destination 和 opts 是必须项!");if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("MAP3D","flyTo() 参数 destination 是必须项!");if(!Cesium.defined(t))throw new NPGIS3D.DeveloperError("MAP3D","flyTo() 参数 opts 是必须项!");var o=this._buildeFlyToOptions(e,t,i,!0);this.viewer.camera.flyTo(o)},NPGIS3D.MAP3D.prototype._setDefaultState=function(){this.thematicMap.isEmpty()&&(NPGIS3D.basemap=NPGIS3D.BaseMap.AMAP_ROAD)},NPGIS3D.MAP3D.prototype._buildeDestination=function(e,t){var i,o;return t?(i=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat),o=Cesium.Cartesian3.fromDegrees(i.lon,i.lat,e.h),o=this.viewer.camera.worldToCameraCoordinatesPoint(o)):o=this.viewer.camera.worldToCameraCoordinatesPoint(o),o},NPGIS3D.MAP3D.prototype._buildeFlyToOptions=function(e,t,i,o){var r=t.time||3,n=t.maximumHeight||void 0,a={};return a.destination=this._buildeDestination(e,o),a.duration=r,a.maximumHeight=n,Cesium.defined(i)&&(a.complete=i),a.orientation=this._buildeOrientation(t),a},NPGIS3D.MAP3D.prototype._buildeOrientation=function(e){var t={},i=e.heading||0,o=e.pitch||-90,r=e.roll||0;return t.heading=Cesium.Math.toRadians(i),t.pitch=Cesium.Math.toRadians(o),t.roll=r,t},NPGIS3D.MAP3D.prototype.flyToGlobal=function(e){var t=this._buildeFlyToOptions(this._orginPosition,{},e,!1);this.viewer.camera.flyTo(t)},NPGIS3D.MAP3D.prototype.setView=function(e){var t=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.position.lon,e.position.lat);this.viewer.scene.camera.setView({destination:Cesium.Cartesian3.fromDegrees(t.lon,t.lat,e.position.h),orientation:e.orientation})},NPGIS3D.MAP3D.prototype.getView=function(){var e=this.viewer.scene.camera.position;return e=NPGIS3D.NPCoordinate.cartesianToPointGeo(e),{position:e,orientation:{heading:this.viewer.scene.camera.heading,pitch:this.viewer.scene.camera.pitch,roll:this.viewer.scene.camera.roll}}},NPGIS3D.MAP3D.prototype.flyToTarget=function(e,t){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.MAP3D","flyTo() 参数 target 是必须项!");Cesium.defined(t)||(t={}),this.viewer.flyTo(e._entity,this._getFlyToOpts(t))},NPGIS3D.MAP3D.prototype.zoomTo=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.MAP3D","zoomTo() 参数 target 是必须项!");this.viewer.zoomTo(e._entity)},NPGIS3D.MAP3D.prototype._getFlyToOpts=function(e){var t,i=e.duration,o=e.maximumHeight||-1,r=e.heading||-1,n=e.pitch||-1,a=e.range||-1,s={};return Cesium.defined(i)||(i=3),s.duration=i,o!==-1&&(s.maximumHeight=o),r===-1&&n===-1&&a===-1||(t=new Cesium.HeadingPitchRange,r!==-1&&(t.heading=Cesium.Math.toRadians(r)),n!==-1&&(t.pitch=Cesium.Math.toRadians(n)),a!==-1&&(t.range=a),s.offset=t),s},NPGIS3D.MAP3D.prototype.setLighting=function(e){this.viewer.scene.globe.enableLighting=e},NPGIS3D.MAP3D.prototype.addOverlayLayer=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("MAP3D","addOverlayLayer() 参数 overlayLayer 没有定义!");this.viewer.dataSources.add(e.dataSource),e.dataSource.clustering.enabled&&e._customStyle()},NPGIS3D.MAP3D.prototype.removeOverlayLayer=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("MAP3D","removeOverlayLayer() 参数 overlayLayer 没有定义!");if(this.viewer.dataSources.contains(e.dataSource)&&!this.viewer.dataSources.remove(e.dataSource,!0))throw new NPGIS3D.DeveloperError("MAP3D","removeOverlayLayer() 失败!")},NPGIS3D.MAP3D.prototype.getCenter=function(){var e=this.viewer.container.offsetWidth,t=this.viewer.container.offsetHeight,i=new Cesium.Cartesian2(e/2,t/2),o=this.viewer.scene.camera.pickEllipsoid(i,Cesium.Ellipsoid.WGS84);return o||(o=this.viewer.scene.camera.position),NPGIS3D.NPCoordinate.cartesianToPointGeo(o)},NPGIS3D.MAP3D.prototype.setCenter=function(e,t,i){this.viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.x||e.lon,e.y||e.lat,e.z||e.h),complete:t,cancel:i})},NPGIS3D.MAP3D.prototype.getWindowCoordinates=function(e){var t=Cesium.Cartesian3.fromDegrees(e.x||e.lon,e.y||e.lat,e.z||e.h),i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,t);return{x:i.x,y:i.y}},NPGIS3D.MAP3D.prototype._setInputAction=function(){var e=this,t=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),i=void 0,o=void 0;this.viewer.pickEvent.addEventListener(function(t){if(!(t.id>1e6)&&e.modelLayers[t.layerName]){var i=e.modelLayers[t.layerName].events.click;if(i&&i instanceof Function){var o=NPGIS3D.NPCoordinate.cartesianToPointGeo(t.position);i({id:t.id,position:o})}}}),t.setInputAction(function(t){try{if("undefined"!=typeof i){var r=i._id;Cesium.defined(r)&&r.indexOf("building")!==-1&&i.polygon&&(i.polygon.material=o),i=void 0,o=void 0}if(i=e.viewer.selectedEntity,!i){var n=e.events.click;if(n&&n instanceof Function){var a=e.viewer.scene.camera.pickEllipsoid(t.position,Cesium.Ellipsoid.WGS84),s=NPGIS3D.NPCoordinate.cartesianToPointGeo(a);n(s)}return}var l=i._id;if(Cesium.defined(l)&&l.indexOf("building")!==-1){var h=i.polygon;h&&(o=h.material,h.material=Cesium.Color.PURPLE)}if(i.overlay&&i.overlay.events.click&&i.overlay.events.click instanceof Function){var u=i.overlay.events.click;u(i.overlay)}}catch(y){throw new NPGIS3D.DeveloperError("NPGIS3D.MAP3D entityClickHandler",y)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction(function(t){e.viewer.trackedEntity=null},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},NPGIS3D.MAP3D.prototype.destroy=function(){this.viewer=null,this.events=null,this.thematicMap=null},NPGIS3D.NPUtil=function(){},NPGIS3D.NPUtil.webglSupport=function(){var e=!0;try{var t=document.createElement("canvas");e=!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(i){e=!1}return e},NPGIS3D.NPUtil.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},NPGIS3D.NPUtil.isObject=function(e){return"[object Object]"==={}.toString.apply(e)},NPGIS3D.NPUtil.isFunction=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},NPGIS3D.NPUtil.isBoolean=function(e){return"boolean"==typeof e},NPGIS3D.NPUtil.isNum=function(e){return!isNaN(e)},NPGIS3D.NPUtil.hexToRgb=function(e){var t,i,o;if(/^#/g.test(e))return t=e.slice(1,3),i=e.slice(3,5),o=e.slice(5,7),[parseInt(t,16),parseInt(i,16),parseInt(o,16)];throw new NPGIS3D.DeveloperError("NPGIS3D.NPUtil.hexToRgb","hexToRgb 16进制颜色格式不正确!")},NPGIS3D.NPUtil.rgb2hex=function(e){for(var t=e[0],i=e[1],o=e[2],r=65536*Number(t)+256*Number(i)+Number(o),n=r.toString(16);n.length<6;)n="0"+n;return"#"+n},NPGIS3D.NPUtil.getRandomColor=function(){return"#"+(16777215*Math.random()<<0).toString(16)},NPGIS3D.NPUtil.StringTrim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},NPGIS3D.NPUtil.StringLtrim=function(e){return e.replace(/(^\s*)/g,"")},NPGIS3D.NPUtil.StringRtrim=function(e){return e.replace(/(\s*$)/g,"")},NPGIS3D.NPUtil.getImage=function(e,t,i){var o=new Cesium.PinBuilder;return t=NPGIS3D.Color.fromCssColorString(t),o.fromText(e,t,i)},NPGIS3D.NPUtil.UUID=function(){var e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=new Array(36),r=0;for(t=0;t<36;t++)8==t||13==t||18==t||23==t?o[t]="-":14==t?o[t]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,o[t]=i[19==t?3&e|8:e]);return o.join("")},NPGIS3D.NPUtil.getHost=function(){function e(e){for(var t,i,o=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),r=document.getElementsByTagName("script"),n="",a=0,s=r.length;a<s;a++)if(t=r[a].getAttribute("src"),t&&(i=t.match(o))){n=i[1];break}return n}return e("NPGIS3D.js")},NPGIS3D.NPUtil.forwardMercator=function(e){var t=20037508.34,i={x:e.x,y:e.y};i.x=i.x*t/180;var o=Math.log(Math.tan((90+i.y)*Math.PI/360))/Math.PI*t;return i.y=Math.max(-20037508.34,Math.min(o,20037508.34)),i},NPGIS3D.NPUtil.distinct=function(e,t){var i=NPGIS3D.NPUtil.forwardMercator(e),o=NPGIS3D.NPUtil.forwardMercator(t);return Math.sqrt((i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y))},NPGIS3D.NPUtil.clone=function(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var i in e)t[i]="undefined"==typeof t[i]?NPGIS3D.NPUtil.clone(e[i],null):t[i];return t},NPGIS3D.NPUtil.extend=function(e,t){e=e||{};for(var i in t)void 0===e[i]&&(e[i]=NPGIS3D.NPUtil.clone(t[i]));return e},NPGIS3D.NPUtil=NPGIS3D.NPUtil||{},NPGIS3D.NPUtil.rad=function(e){return e*Math.PI/180},NPGIS3D.NPUtil.getGeodesicArea=function(e){var t=0,i=e.length;if(i>2){for(var o=0;o<i-1;o++)p1=e[o],p2=e[o+1],t+=NPGIS3D.NPUtil.rad(p2.x-p1.x)*(2+Math.sin(NPGIS3D.NPUtil.rad(p1.y))+Math.sin(NPGIS3D.NPUtil.rad(p2.y)));t=6378137*t*6378137/2}return t},NPGIS3D.NPUtil.getArea=function(e){var t=0,i=e.length;if(i>2){var o=0,r=e[0];r=_3dhelper.degreeToWebMoctor(r.x,r.y);for(var n=1;n<i-1;n++){var a=e[n],s=e[n+1];a=_3dhelper.degreeToWebMoctor(a.x,a.y),s=_3dhelper.degreeToWebMoctor(s.x,s.y),o+=(a.lon-r.lon)*(s.lat-r.lat)-(a.lat-r.lat)*(s.lon-r.lon)}t=Math.abs(o)/2}return t},NPGIS3D.NPUtil.CoordinateHelper=function(){};var pi=3.141592653589793,ee=.006693421622965943,x_pi=52.35987755982988,pole=20037508.34,a=6378245,_3dhelper={degreeToWebMoctor:function(e,t){var i,o={lon:0,lat:0};return e=parseFloat(e),t=parseFloat(t),o.lon=e/180*20037508.34,t>85.05112&&(t=85.05112),t<-85.05112&&(t=-85.05112),t=Math.PI/180*t,i=Math.PI/4+t/2,o.lat=20037508.34*Math.log(Math.tan(i))/Math.PI,o},webMoctorToDegree:function(e,t){return e=180*e/pole,t=180/Math.PI*(2*Math.atan(Math.exp(t/pole*Math.PI))-Math.PI/2),{lon:e,lat:t}},gcjTowgs84:function(e,t){var i={lon:0,lat:0},o=e-(_3dhelper.wgs84ToGcj(e,t).lon-e),r=t-(_3dhelper.wgs84ToGcj(e,t).lat-t);return i.lon=o,i.lat=r,i},encryptToBd:function(e,t){var i=e,o=t,r=Math.sqrt(i*i+o*o)+2e-5*Math.sin(o*x_pi),n=Math.atan2(o,i)+3e-6*Math.cos(i*x_pi),a=r*Math.cos(n)+.0065,s=r*Math.sin(n)+.006;return{lon:a,lat:s}},bdTodecrypt:function(e,t){var i=e-.0065,o=t-.006,r=Math.sqrt(i*i+o*o)-2e-5*Math.sin(o*x_pi),n=Math.atan2(o,i)-3e-6*Math.cos(i*x_pi),a=r*Math.cos(n),s=r*Math.sin(n);return{lon:a,lat:s}},wgs84ToGcj:function(e,t){var i,o,r,n,s,l,h,u={};return e=parseFloat(e),t=parseFloat(t),this.outofChina(t,e)?(u.lon=e,u.lat=t,u):(i=_3dhelper.transformLat(e-105,t-35),o=_3dhelper.transformLon(e-105,t-35),r=t/180*pi,n=Math.sin(r),n=1-ee*n*n,s=Math.sqrt(n),i=180*i/(a*(1-ee)/(n*s)*pi),o=180*o/(a/s*Math.cos(r)*pi),l=t+i,h=e+o,u.lon=h,u.lat=l,u)},outofChina:function(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)},transformLat:function(e,t){var i=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*pi)+20*Math.sin(2*e*pi))/3,i+=2*(20*Math.sin(t*pi)+40*Math.sin(t/3*pi))/3,i+=2*(160*Math.sin(t/12*pi)+320*Math.sin(t*pi/30))/3},transformLon:function(e,t){var i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*pi)+20*Math.sin(2*e*pi))/3,i+=2*(20*Math.sin(e*pi)+40*Math.sin(e/3*pi))/3,i+=2*(150*Math.sin(e/12*pi)+300*Math.sin(e/30*pi))/3}};NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap=function(e,t,i){var o=NPGIS3D.basemap,r={lon:0,lat:0,h:i};switch(o){case NPGIS3D.BaseMap.AMAP_ROAD:r=_3dhelper.wgs84ToGcj(e,t);break;case NPGIS3D.BaseMap.AMAP_AERIAL:r=_3dhelper.wgs84ToGcj(e,t);break;case NPGIS3D.BaseMap.GOOGLE_AERIAL:r=_3dhelper.wgs84ToGcj(e,t);break;case NPGIS3D.BaseMap.GOOGLE_ROAD:r=_3dhelper.wgs84ToGcj(e,t);break;case NPGIS3D.BaseMap.BING_AERIAL:break;case NPGIS3D.BaseMap.BING_AERIAL_WITH_LABELS:break;case NPGIS3D.BaseMap.BING_ROAD:break;case NPGIS3D.BaseMap.BING_ORDNANCE_SURVEY:break;case NPGIS3D.BaseMap.BING_COLLINS_BART:break;default:r.lon=e,r.lat=t}return r.h=i,r},NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasemap=function(e,t,i){var o=NPGIS3D.basemap,r={lon:0,lat:0,h:i};switch(o){case NPGIS3D.BaseMap.AMAP_ROAD:r=_3dhelper.gcjTowgs84(e,t);break;case NPGIS3D.BaseMap.AMAP_AERIAL:r=_3dhelper.gcjTowgs84(e,t);break;case NPGIS3D.BaseMap.GOOGLE_AERIAL:r=_3dhelper.gcjTowgs84(e,t);break;case NPGIS3D.BaseMap.GOOGLE_ROAD:r=_3dhelper.gcjTowgs84(e,t);break;case NPGIS3D.BaseMap.BING_AERIAL:break;case NPGIS3D.BaseMap.BING_AERIAL_WITH_LABELS:break;case NPGIS3D.BaseMap.BING_ROAD:break;case NPGIS3D.BaseMap.BING_ORDNANCE_SURVEY:break;case NPGIS3D.BaseMap.BING_COLLINS_BART:break;default:r.lon=e,r.lat=t}return r.h=i,r},NPGIS3D.NPCoordinate=function(){},NPGIS3D.NPCoordinate.coordinateTransByBasemap=function(e,t){return NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e,t)},NPGIS3D.NPCoordinate.cartesianToPointGeo=function(e,t){var i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e),o=Cesium.Math.toDegrees(i.longitude),r=Cesium.Math.toDegrees(i.latitude);if(!t){var n=NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasemap(o,r);o=n.lon,r=n.lat}return point=new NPGIS3D.Geometry.Point3D(o,r,i.height),point},NPGIS3D.NPCoordinate.positionsToPolylineGeo=function(e){var t,i,o,r,n=e.length,a=new Array;for(t=0;t<n;t++)i=e[t],o=NPGIS3D.NPCoordinate.cartesianToPointGeo(i),a.push(o);return r=new NPGIS3D.Geometry.Polyline([a])},NPGIS3D.NPCoordinate.positionsToPolygonGeo=function(e){var t,i,o,r,n=e.length,a=new Array;for(t=0;t<n;t++)i=e[t],o=NPGIS3D.NPCoordinate.cartesianToPointGeo(i),a.push(o);return r=new NPGIS3D.Geometry.Polygon([a])},NPGIS3D.NPCoordinate.extentToExtentGeo=function(e){var t=Cesium.Rectangle.northwest(e,t),i=Cesium.Rectangle.southeast(e,i),o=NPGIS3D.NPCoordinate.cartographicToDegrees(t),r=NPGIS3D.NPCoordinate.cartographicToDegrees(i),n=Math.min(r.lat,o.lat),a=Math.min(o.lon,r.lon),s=Math.max(o.lat,r.lat),l=Math.max(r.lon,o.lon);return new NPGIS3D.Geometry.Extent(a,n,l,s)},NPGIS3D.NPCoordinate.cartographicToDegrees=function(e){var t=Cesium.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(e,t),i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),o=Cesium.Math.toDegrees(i.longitude),r=Cesium.Math.toDegrees(i.latitude),n=NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasemap(o,r);return n},NPGIS3D.NPCoordinate.fromNPCartesian3List=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].lon),t.push(e[i].lat),t.push(e[i].h||0);return Cesium.Cartesian3.fromDegreesArrayHeights(t)},NPGIS3D.DeveloperError=function(e,t){this.name=e,this.message=t},NPGIS3D.DeveloperError.prototype.toString=function(){var e=this.name+": "+this.message;return e},NPGIS3D.Promise=function(){"use strict";this._callbacks=[],this._isdone,this.result},NPGIS3D.Promise.prototype.then=function(e,t){var i,o;return this._isdone?i=e.apply(t,this.result):(i=this,this._callbacks.push(function(){o=e.apply(t,arguments),o&&"function"==typeof o.then&&o.then(i.done,i)})),i},NPGIS3D.Promise.prototype.done=function(){var e,t=this._callbacks.length;for(this.result=arguments,this._isdone=!0,e=0;e<t;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[]},NPGIS3D.Promise.prototype.chain=function(e,t){var i=this;return 0===e.length?i.done.apply(i,t):e[0].apply(null,t).then(function(){e.splice(0,1),i.chain(e,arguments).then(function(){i.done.apply(i,arguments)})}),i},NPGIS3D.Promise.prototype.when=function(e){function t(e){return function(){a+=1,n[e]=Array.prototype.slice.call(arguments),a===i&&r.done(n)}}var i,o,r=this,n=[],a=0;if(!e||!e.length)return r.done(n),r;for(i=e.length,o=0;o<i;o++)e[o].then(t(o));return r},NPGIS3D.HttpPromise=function(){"use strict"},NPGIS3D.HttpPromise.prototype.get=function(e,t,i){return this._ajax("GET",e,t,i)},NPGIS3D.HttpPromise.prototype.post=function(e,t,i){return this._ajax("POST",e,t,i)},NPGIS3D.HttpPromise.prototype.put=function(e,t,i){return this._ajax("PUT",e,t,i)},NPGIS3D.HttpPromise.prototype["delete"]=function(e,t,i){return this._ajax("DELETE",e,t,i)},NPGIS3D.HttpPromise.prototype._encode=function(e){var t,i,o,r="";if("string"==typeof e)r=e;else{t=encodeURIComponent,i=[];for(o in e)e.hasOwnProperty(o)&&i.push(t(o)+"="+t(e[o]));r=i.join("&")}return r},NPGIS3D.HttpPromise.prototype._newXHR=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e},NPGIS3D.HttpPromise.prototype._ajax=function(e,t,i,o){function r(){n.abort(),u.done(!0,"time out")}var n,a,s,l,h,u=new NPGIS3D.Promise,y="application/x-www-form-urlencoded",c=1e4;i=i||{},o=o||{};try{n=this._newXHR()}catch(p){return u.done(!0,"no xhr"),u}a=this._encode(i),"GET"===e&&(""!==a&&(t+="?"+a),a=null),n.open(e,t,!0);for(s in o)o.hasOwnProperty(s)&&("content-type"===s.toLowerCase()?y=o[s]:n.setRequestHeader(s,o[s]));return n.setRequestHeader("Content-type",y),c=1e4,c&&(l=setTimeout(r,c)),n.onreadystatechange=function(){c&&clearTimeout(l),4===n.readyState&&(h=!n.status||(n.status<200||n.status>=300)&&304!==n.status,u.done(h,n.responseText),n=null)},n.send(a),u},NPGIS3D.HashMap=function(){"use strict";this.elements=new Array},NPGIS3D.HashMap.prototype.size=function(){return this.elements.length},NPGIS3D.HashMap.prototype.isEmpty=function(){return this.elements.length<1},NPGIS3D.HashMap.prototype.clear=function(){this.elements=new Array},NPGIS3D.HashMap.prototype.put=function(e,t){this.elements.push({key:e,value:t})},NPGIS3D.HashMap.prototype.removeByKey=function(e){var t,i=!1,o=this.elements.length;try{for(t=0;t<o;t++)if(this.elements[t].key==e)return this.elements.splice(t,1),!0}catch(r){i=!1}return i},NPGIS3D.HashMap.prototype.removeByValue=function(e){var t,i=!1,o=this.elements.length;try{for(t=0;t<o;t++)if(this.elements[t].value==e)return this.elements.splice(t,1),!0}catch(r){i=!1}return i},NPGIS3D.HashMap.prototype.removeByValueAndKey=function(e,t){var i,o=!1,r=this.elements.length;try{for(i=0;i<r;i++)if(this.elements[i].value==t&&this.elements[i].key==e)return this.elements.splice(i,1),!0}catch(n){o=!1}return o},NPGIS3D.HashMap.prototype.get=function(e){var t,i=this.elements.length;try{for(t=0;t<i;t++)if(this.elements[t].key==e)return this.elements[t].value}catch(o){return!1}return!1},NPGIS3D.HashMap.prototype.element=function(e){return e<0||e>=this.elements.length?null:this.elements[e]},NPGIS3D.HashMap.prototype.containsKey=function(e){var t,i=!1,o=this.elements.length;try{for(t=0;t<o;t++)this.elements[t].key==e&&(i=!0)}catch(r){i=!1}return i},NPGIS3D.HashMap.prototype.containsValue=function(e){var t,i=!1,o=this.elements.length;try{for(t=0;t<o;t++)this.elements[t].value==e&&(i=!0)}catch(r){i=!1}return i},NPGIS3D.HashMap.prototype.containsObj=function(e,t){var i,o=!1,r=this.elements.length;try{for(i=0;i<r;i++)this.elements[i].value==t&&this.elements[i].key==e&&(o=!0)}catch(n){o=!1}return o},NPGIS3D.HashMap.prototype.values=function(){var e,t=new Array,i=this.elements.length;for(e=0;e<i;e++)t.push(this.elements[e].value);return t},NPGIS3D.HashMap.prototype.valuesByKey=function(e){var t,i=new Array,o=this.elements.length;for(t=0;t<o;t++)this.elements[t].key==e&&i.push(this.elements[t].value);return i},NPGIS3D.HashMap.prototype.keys=function(){var e,t=new Array,i=this.elements.length;for(e=0;e<i;e++)t.push(this.elements[e].key);return t},NPGIS3D.HashMap.prototype.keysByValue=function(e){var t,i=new Array,o=this.elements.length;for(t=0;t<o;t++)e==this.elements[t].value&&i.push(this.elements[t].key);return i},NPGIS3D.HashMap.prototype.keysRemoveDuplicate=function(){var e,t,i=new Array,o=this.elements.length,r=!0,n=i.length;for(e=0;e<o;e++){for(r=!0,t=0;t<n;t++)if(i[t]==this.elements[e].key){r=!1;break}r&&i.push(this.elements[e].key)}return i},NPGIS3D.BaseMap={TDT_ROAD:"tdtRoad",TDT_AERIAL:"tdtAerial",TDT_AERIAL_WITH_LABELS:"tdtAerialWithLabels",TDT_ROAD_WITH_LABELS:"tdtRoadWithLabels",AMAP_ROAD:"amapRoad",AMAP_AERIAL:"amapAerial",BAIDU_ROAD:"baiduRoad",GOOGLE_AERIAL:"googleAerial",GOOGLE_ROAD:"googleRoad",BING_AERIAL:"Aerial",BING_AERIAL_WITH_LABELS:"AerialWithLabels",BING_ROAD:"bingRoad",BING_ORDNANCE_SURVEY:"OrdnanceSurvey",BING_COLLINS_BART:"CollinsBart"},NPGIS3D.AnimationLine3D=function(e){"use strict";this.camera=e.viewer.camera,this._viewer=e,this._multiplier,this._isFollow,this._firstPoint,this._startTime,this._stopTime,this._entity=void 0,this._position,this._preCartesian,this._trackFlightOverLayLayer,this._trackType,this._trackLine,this._tickListenerHandler},NPGIS3D.AnimationLine3D.prototype.trackFlight=function(e,t){this._trackType="flight",this._track(e,t)},NPGIS3D.AnimationLine3D.prototype.trackDrive=function(e,t){this._trackType="drive",this._track(e,t)},NPGIS3D.AnimationLine3D.prototype.stopTrack=function(){this._doStop()},NPGIS3D.AnimationLine3D.prototype.destroy=function(){this._viewer=null},NPGIS3D.AnimationLine3D.prototype._track=function(e,t){this._trackLine=e,this._getFirstPoint();var i=this._buildOptions(t),o=(i.follow?this._firstPoint.h:500,this);o._trackFlightOverLayLayer=new NPGIS3D.Layer.OverlayLayer("trackFlightOverLayLayer"),o._viewer.addOverlayLayer(o._trackFlightOverLayLayer),o._multiplier=i.multiplier,o._isFollow=i.follow;var r=new Date;o._startTime=Cesium.JulianDate.fromDate(new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours())),o._entity=o._getEntity(i.color,i.width),o._entity.position.setInterpolationOptions({interpolationDegree:1,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation}),o._trackFlightOverLayLayer.addOverlay(o._entity),o._setClock(),o._isFollow&&(o._tickListenerHandler=function(e){var t,i,r=e._currentTime,n=Cesium.JulianDate.equals(r,o._stopTime);n?o._doStop():(t=o._position.getValue(r),Cesium.defined(t)&&(Cesium.defined(o._preCartesian)&&(i=o._getRadian(t,o._preCartesian),o._setCamera(t,i)),o._preCartesian=t))},o._viewer.viewer.clock.onTick.addEventListener(o._tickListenerHandler))},NPGIS3D.AnimationLine3D.prototype._setCamera=function(e,t){var i=Cesium.Math.toRadians(-10),o=20;"flight"===this._trackType&&(i=Cesium.Math.toRadians(-30),o=100),this.camera.lookAt(e,new Cesium.HeadingPitchRange(t,i,o))},NPGIS3D.AnimationLine3D.prototype._getRadian=function(e,t){var i=this._cartesianToDegrees(e),o=this._cartesianToDegrees(t),r=90-this._calculateRadian(i,o),n=Math.PI+Cesium.Math.toRadians(r);return n},NPGIS3D.AnimationLine3D.prototype._cartesianToDegrees=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e),i=Cesium.Math.toDegrees(t.longitude),o=Cesium.Math.toDegrees(t.latitude);return NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasemap(i,o)},NPGIS3D.AnimationLine3D.prototype._calculateRadian=function(e,t){return 180*Math.atan2(t.lat-e.lat,t.lon-e.lon)/Math.PI},NPGIS3D.AnimationLine3D.prototype._doStop=function(){Cesium.defined(this._entity)&&(this._tickListenerHandler&&this._viewer.viewer.clock.onTick.removeEventListener(this._tickListenerHandler),this._isFollow&&this.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this._viewer.removeOverlayLayer(this._trackFlightOverLayLayer),this._preCartesian=null,this._entity=null,this._multiplier=null,this._isFollow=null,this._firstPoint=null,this._startTime=null,this._stopTime=null,this._position=null,this._trackFlightOverLayLayer.destroy(),this._trackType=null,this._trackLine=null,this._tickListenerHandler=null)},NPGIS3D.AnimationLine3D.prototype._getFirstPoint=function(){var e,t,i=this._trackLine.paths.length;for(e=0;e<i;e++)t=this._trackLine.paths[e],this._firstPoint=NPGIS3D.NPCoordinate.coordinateTransByBasemap(t[0].lon,t[0].lat),this._firstPoint.h=t[0].h?t[0].h:30},NPGIS3D.AnimationLine3D.prototype._setClock=function(){var e=this._viewer.viewer.clock;e.startTime=this._startTime.clone(),e.stopTime=this._stopTime.clone(),e.currentTime=this._startTime.clone(),e.clockRange=Cesium.ClockRange.CLAMPED,e.multiplier=this._multiplier},NPGIS3D.AnimationLine3D.prototype._getEntity=function(e,t){var i=NPGIS3D.NPUtil.getHost(),o=i+"/lib/Cesium/Assets/Models/CesiumMilkTruck.gltf";"flight"===this._trackType&&(o=i+"/lib/Cesium/Assets/Models/Cesium_Air.gltf"),this._position=this._computeTrajectory();var r={availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this._startTime,stop:this._stopTime})]),position:this._position,orientation:new Cesium.VelocityOrientationProperty(this._position),model:{uri:o,minimumPixelSize:28,scale:.6},path:{resolution:1,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.fromBytes(e[0],e[1],e[2],255),outlineWidth:1,outlineColor:Cesium.Color.fromBytes(e[0],e[1],e[2],255)}),width:t}};return new Cesium.Entity(r)},NPGIS3D.AnimationLine3D.prototype._computeTrajectory=function(){var e,t,i,o,r,n,a,s,l,h=new Cesium.SampledPositionProperty,u=this._trackLine.paths.length,y=0;for(e=0;e<u;e++){for(i=this._trackLine.paths[e],o=i.length,t=0;t<o;t++)n=i[t],a=NPGIS3D.NPCoordinate.coordinateTransByBasemap(n.lon,n.lat),l="flight"===this._trackType?Cesium.Cartesian3.fromDegrees(a.lon,a.lat,n.h):Cesium.Cartesian3.fromDegrees(a.lon,a.lat,n.h),t>0&&(y+=Cesium.Cartesian3.distance(s,l)),r=Cesium.JulianDate.addSeconds(this._startTime,y,new Cesium.JulianDate),h.addSample(r,l),s=l;this._stopTime=Cesium.JulianDate.addSeconds(this._startTime,y,new Cesium.JulianDate)}return h},NPGIS3D.AnimationLine3D.prototype._buildOptions=function(e){var t,i,o=e.isLoop||!1,r=e.multiplier||10,n=e.width||5,a=e.color||"#FF0000",s=NPGIS3D.NPUtil.hexToRgb(a),l=e.follow;return t="undefined"==typeof e.follow||l,i={isLoop:o,multiplier:r,color:s,width:n,follow:t}},NPGIS3D.Geometry=function(){"use strict"},NPGIS3D.Geometry.Point=function(e,t){"use strict";NPGIS3D.Geometry.call(this),this.type="point2D",this.lon=Number(e),this.lat=Number(t)},NPGIS3D.inherits(NPGIS3D.Geometry.Point,NPGIS3D.Geometry),NPGIS3D.Geometry.Point3D=function(e,t,i){"use strict";NPGIS3D.Geometry.call(this),this.type="point3D",this.lon=Number(e),this.lat=Number(t),this.h=Number(i)||0},NPGIS3D.inherits(NPGIS3D.Geometry.Point3D,NPGIS3D.Geometry),NPGIS3D.Geometry.Polyline=function(e){"use strict";NPGIS3D.Geometry.call(this),this.type="polyline",this.paths=e},NPGIS3D.inherits(NPGIS3D.Geometry.Polyline,NPGIS3D.Geometry),NPGIS3D.Geometry.Polygon=function(e){"use strict";NPGIS3D.Geometry.call(this),this.type="polygon",this.rings=e},NPGIS3D.inherits(NPGIS3D.Geometry.Polygon,NPGIS3D.Geometry),NPGIS3D.Geometry.Extent=function(e,t,i,o){"use strict";NPGIS3D.Geometry.call(this),this.type="Extent",this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=o,this.extent={xmin:e,ymin:t,xmax:i,ymax:o}},NPGIS3D.inherits(NPGIS3D.Geometry.Extent,NPGIS3D.Geometry),NPGIS3D.Geometry.Circle=function(e,t){"use strict";NPGIS3D.Geometry.call(this),this.type="circle",this.center=e,this.radius=t},NPGIS3D.inherits(NPGIS3D.Geometry.Circle,NPGIS3D.Geometry),NPGIS3D.Layer=function(){"use strict"},NPGIS3D.Layer.MapLayer=function(e,t,i,o){"use strict";NPGIS3D.Layer.call(this),
this.layerType=o,this.url=e,this.name=t||"地图服务",this._minimumLevel=0,this._maximumLevel=18,this._baseMapType=NPGIS3D.BaseMap.AMAP_ROAD,this._options=this._buildeOpts(i),this.imageryLayers=new Array,this._getBaseLayer()},NPGIS3D.Layer.MapLayer.prototype.show=function(){var e,t=this.imageryLayers.length;for(e=0;e<t;e++)this.imageryLayers[e].show=!0},NPGIS3D.Layer.MapLayer.prototype.hide=function(){var e,t=this.imageryLayers.length;for(e=0;e<t;e++)this.imageryLayers[e].show=!1},NPGIS3D.Layer.MapLayer.prototype._getBaseLayer=function(){Cesium.defined(this.url)?(Cesium.defined(this._options.style)&&(this._baseMapType=this._options.style),this.imageryLayers[0]=new Cesium.ImageryLayer(this._getOfflineBaseLayer(),this._options)):this._getOnlineBaseLayers()},NPGIS3D.Layer.MapLayer.prototype._getOnlineBaseLayers=function(){if("TDTLayer"===this.layerType){var e=this._getOnlineBaseLayer(this._options.style),t=0,i=e.length;for(t;t<i;t++)this.imageryLayers[t]=new Cesium.ImageryLayer(e[t],this._options)}else this.imageryLayers[0]=new Cesium.ImageryLayer(this._getOnlineBaseLayer(),this._options)},NPGIS3D.Layer.MapLayer.prototype._buildeOpts=function(e){var t,i=e;return Cesium.defined(e.minimumLevel)&&(this._minimumLevel=e.minimumLevel),Cesium.defined(e.maximumLevel)&&(this._maximumLevel=e.maximumLevel),Cesium.defined(e.rectangle)&&(t=this._extentTrans(i.rectangle),i.rectangle=Cesium.Rectangle.fromDegrees(t.xmin,t.ymin,t.xmax,t.ymax)),i},NPGIS3D.Layer.MapLayer.prototype._extentTrans=function(e){var t=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e.xmin,e.ymin),i=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e.xmax,e.ymax);return new NPGIS3D.Geometry.Extent(t.lon,t.lat,i.lon,i.lat)},NPGIS3D.Layer.MapLayer.prototype._getOfflineBaseLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:this.url,credit:this.name,minimumLevel:this._minimumLevel,maximumLevel:this._maximumLevel})},NPGIS3D.inherits(NPGIS3D.Layer.MapLayer,NPGIS3D.Layer),NPGIS3D.Layer.TDTLayer=function(e,t,i){"use strict";NPGIS3D.Layer.MapLayer.call(this,e,t,i,"TDTLayer")},NPGIS3D.Layer.TDTLayer.prototype._getOnlineBaseLayer=function(e){var t=[];switch(Cesium.defined(e)?this._baseMapType=e:this._baseMapType=NPGIS3D.BaseMap.TDT_AERIAL_WITH_LABELS,e){case NPGIS3D.BaseMap.TDT_AERIAL:t[0]=this._getAerialLayer();break;case NPGIS3D.BaseMap.TDT_ROAD:t[0]=this._getRoadLayer();break;case NPGIS3D.BaseMap.TDT_ROAD_WITH_LABELS:t[0]=this._getRoadLayer(),t[1]=this._getLabelsLayer();break;default:t[0]=this._getAerialLayer(),t[1]=this._getLabelsLayer()}return t},NPGIS3D.Layer.TDTLayer.prototype._getLabelsLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPGIS3D.Layer.TDTLayer.prototype._getAerialLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPGIS3D.Layer.TDTLayer.prototype._getRoadLayer=function(){return new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.com/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=vec&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"w",credit:this.name,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18})},NPGIS3D.inherits(NPGIS3D.Layer.TDTLayer,NPGIS3D.Layer.MapLayer),NPGIS3D.Layer.GoogleLayer=function(e,t,i){"use strict";NPGIS3D.Layer.MapLayer.call(this,e,t,i,"GoogleLayer")},NPGIS3D.Layer.GoogleLayer.prototype._getOnlineBaseLayer=function(){var e,t=this._options.style;switch(Cesium.defined(t)?this._baseMapType=t:this._baseMapType=NPGIS3D.BaseMap.GOOGLE_AERIAL,t){case NPGIS3D.BaseMap.GOOGLE_ROAD:e=this._getRoadLayer();break;default:e=this._getAerialLayer()}return e},NPGIS3D.Layer.GoogleLayer.prototype._getAerialLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.google.cn/vt/lyrs=y@177000000&,highlight:0x35f05296e7142cb9:0xb9625620af0fa98a@1|style:maps&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Galil&src=app",credit:this.name,subdomains:["mt0","mt1","mt2","mt3"],minimumLevel:this._minimumLevel,maximumLevel:this._maximumLevel})},NPGIS3D.Layer.GoogleLayer.prototype._getRoadLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.google.cn/vt?pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i285000000!3m9!2szh-CN!3sCN!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!4e0",credit:this.name,subdomains:["mt0","mt1","mt2","mt3"],minimumLevel:this._minimumLevel,maximumLevel:this._maximumLevel})},NPGIS3D.inherits(NPGIS3D.Layer.GoogleLayer,NPGIS3D.Layer.MapLayer),NPGIS3D.Layer.BingLayer=function(e,t,i){"use strict";NPGIS3D.Layer.MapLayer.call(this,e,t,i,"BingLayer")},NPGIS3D.Layer.BingLayer.prototype._getOnlineBaseLayer=function(){var e=this._options.style;return Cesium.defined(e)?this._baseMapType=e:this._baseMapType=e=NPGIS3D.BaseMap.BING_AERIAL,new Cesium.BingMapsImageryProvider({url:"//dev.virtualearth.net",key:"AnnJBLmScQLGhCET-i0R2hNlhBsnyR2pC2EXe4zCJrgWIIqbFToRle3Xwbiig6wK",mapStyle:e})},NPGIS3D.inherits(NPGIS3D.Layer.BingLayer,NPGIS3D.Layer.MapLayer),NPGIS3D.Layer.GaoDeLayer=function(e,t,i){"use strict";NPGIS3D.Layer.MapLayer.call(this,e,t,i,"GaoDeLayer")},NPGIS3D.Layer.GaoDeLayer.prototype._getOnlineBaseLayer=function(){var e,t=this._options.style;switch(Cesium.defined(t)?this._baseMapType=t:this._baseMapType=NPGIS3D.BaseMap.AMAP_AERIAL,t){case NPGIS3D.BaseMap.AMAP_ROAD:e=this._getRoadLayer();break;default:e=this._getAerialLayer()}return e},NPGIS3D.Layer.GaoDeLayer.prototype._getAerialLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.is.autonavi.com/appmaptile??lang=zh_cn&size=1&scale=1&style=6&L={z}&Z={z}&Y={y}&X={x}",credit:this.name,subdomains:["webst01","webst02","webst03","webst04"],tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})},NPGIS3D.Layer.GaoDeLayer.prototype._getRoadLayer=function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.is.autonavi.com/appmaptile??lang=zh_cn&size=1&scale=1&style=7&L={z}&Z={z}&Y={y}&X={x}",credit:this.name,subdomains:["webrd01","webrd02","webrd03","webrd04"],tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})},NPGIS3D.inherits(NPGIS3D.Layer.GaoDeLayer,NPGIS3D.Layer.MapLayer),NPGIS3D.Layer.OverlayLayer=function(e){"use strict";if(NPGIS3D.Layer.call(this),this.layerType="OverlayLayer",!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","name 是必须项!");if(e=NPGIS3D.NPUtil.StringTrim(e),""===e)throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","name 不能为空!");this.name=e,this.dataSource=new Cesium.CustomDataSource(this.name)},NPGIS3D.Layer.OverlayLayer.prototype.show=function(){this.dataSource.show=!0},NPGIS3D.Layer.OverlayLayer.prototype.hide=function(){this.dataSource.show=!1},NPGIS3D.Layer.OverlayLayer.prototype.addOverlay=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","addOverlay() 参数 overlay 是必须项!");var t=e._entity||e;this.dataSource.entities.add(t)},NPGIS3D.Layer.OverlayLayer.prototype.removeOverlay=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","removeOverlay() 参数 overlay 是必须项!");if(this.dataSource.entities.contains(e._entity)&&(e=e._entity||e,!this.dataSource.entities.remove(e)))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","removeOverlay() 参数 overlay 删除失败!")},NPGIS3D.Layer.OverlayLayer.prototype.removeAllOverlay=function(){this.dataSource.entities.removeAll()},NPGIS3D.Layer.OverlayLayer.prototype.getOverlayById=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","getOverlayById() 参数 id 是必须项!");if(e=NPGIS3D.NPUtil.StringTrim(e),""===e)throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","getOverlayById() 参数 id 不能为空!");return this.dataSource.entities.getById(e)},NPGIS3D.Layer.OverlayLayer.prototype.removeOverlayById=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","removeOverlayById() id 是必须项!");if(e=NPGIS3D.NPUtil.StringTrim(e),""===e)throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","removeOverlayById() id 不能为空!");if(!this.dataSource.entities.removeById(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Layer.OverlayLayer","removeOverlayById() 删除失败!")},NPGIS3D.Layer.OverlayLayer.prototype.destroy=function(){this.layerType=null,this.name=null,this.dataSource=null},NPGIS3D.inherits(NPGIS3D.Layer.OverlayLayer,NPGIS3D.Layer),NPGIS3D.Layer.ClusterLayer=function(e,t){"use strict";NPGIS3D.Layer.OverlayLayer.call(this,e),this.layerType="ClusterLayer",this.getImage=t&&t.getImage?t.getImage:function(){var e=NPGIS3D.NPUtil.getHost()+"lib/Cesium/Assets";return e+"/img/RedPin1LargeB.png"},this.clusterStyle=t&&t.clusterStyle?t.clusterStyle:{lableFont:"20px 宋体",lableFillColor:"#FFFFFF",lableOutlineColor:"#FFFFFF",lableOutlineWidth:1,lablePixelOffset:{x:0,y:-32},imageVertical:1},this.getText=t&&t.getText?t.getText:function(e){return e.toString()},this.dataSource.clustering.enabled=!0,this.dataSource.clustering.pixelRange=t&&t.distance?t.distance:80,this.dataSource.clustering.minimumClusterSize=t&&t.threshold?t.threshold:2},NPGIS3D.inherits(NPGIS3D.Layer.ClusterLayer,NPGIS3D.Layer.OverlayLayer),NPGIS3D.Layer.ClusterLayer.prototype._customStyle=function(){var e=this,t=(this.dataSource.clustering.clusterEvent.addEventListener(function(t,i){var o=e.clusterStyle;if(o.lableFont&&(i.label.font=o.lableFont),o.lableFillColor){var r=NPGIS3D.NPUtil.hexToRgb(o.lableFillColor);i.label.fillColor={alpha:1,blue:r[1],green:r[2],red:r[0]}}if(o.lableOutlineColor){var n=NPGIS3D.NPUtil.hexToRgb(o.lableOutlineColor);i.label.fillColor={alpha:1,blue:n[1],green:n[2],red:n[0]}}o.lableOutlineWidth&&(i.label.outlineWidth=o.lableOutlineWidth),o.lablePixelOffset&&(i.label.pixelOffset=o.lablePixelOffset),i.label.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.label.verticalOrigin=Cesium.VerticalOrigin.CENTER,i.label.show=!0,i.label.text=e.getText(t.length),i.billboard.show=!0,i.billboard.verticalOrigin=o.imageVertical?Cesium.VerticalOrigin.BOTTOM:Cesium.VerticalOrigin.CENTER,i.billboard.image=e.getImage(t.length,i)}),this.dataSource.clustering.pixelRange);this.dataSource.clustering.pixelRange=0,this.dataSource.clustering.pixelRange=t},NPGIS3D.Layer.ClusterLayer.prototype.addOverlays=function(e){for(var t=0;t<e.length;t++)this.dataSource.entities.add(e[t]._entity)},NPGIS3D.Layer.TerrainLayer=function(e,t){"use strict";this._layer=new Cesium.CesiumTerrainProvider({url:e,requestVertexNormals:!1})},NPGIS3D.HeatMapLayer=function(e,t,i){var o=CesiumHeatmap.create(e.viewer,t||{north:40.908179104039014,east:115.91325577059447,south:30.008179104039016,west:100.01325577059447},i||{opacity:.3,visible:!0,radius:10});this.setWGS84Data=function(e,t,i){o.setWGS84Data(e||0,t||300,i)}},NPGIS3D.Layer.S3MLayer=function(e,t,i){"use strict";this.url=e,this.name=t,this.opts=i,this.events={},NPGIS3D.Layer.call(this)},NPGIS3D.Layer.S3MLayer.prototype.setVisible=function(e){this.obj&&(this.obj.visible=e)},NPGIS3D.Layer.S3MLayer.prototype.setObjsVisible=function(e,t){this.obj&&this.obj.setObjsVisible(e,t)},NPGIS3D.Layer.S3MLayer.prototype.setEnableSelect=function(e){this.obj&&(this.obj.selectEnabled=e)},NPGIS3D.Layer.S3MLayer.prototype.setSelectColor=function(e){this.obj&&(this.obj.selectEnabled=e)},NPGIS3D.Layer.S3MLayer.prototype.getPosition=function(){if(this.obj){var e=this.obj._position,t=NPGIS3D.NPCoordinate.cartesianToPointGeo(e,!0);return t}},NPGIS3D.Layer.S3MLayer.prototype.setObjsColor=function(e,t){this.obj&&this.obj.setObjsColor(e,t)},NPGIS3D.Layer.S3MLayer.prototype.removeObjsColor=function(e){this.obj&&this.obj.removeObjsColor(e)},NPGIS3D.Layer.S3MLayer.prototype.setSelection=function(e){this.obj&&this.obj.setSelection(e)},NPGIS3D.Layer.S3MLayer.prototype.releaseSelection=function(){this.obj&&this.obj.releaseSelection()},NPGIS3D.Layer.S3MLayer.prototype.getSelection=function(){return this.obj?this.obj.getSelection():[]},NPGIS3D.Layer.S3MLayer.prototype.addFlattenRegion=function(e,t){if(this.obj){for(var i=[],o=Cesium.Ellipsoid.WGS84.cartesianToCartographic(S3MLayer.obj._position),r=0;r<e.length;r++){var n=e[r];i.push(n.lon,n.lat,n.h+o.height)}this.obj.addFlattenRegion({position:i,name:t})}},NPGIS3D.Layer.S3MLayer.prototype.removeAllFlattenRegion=function(){this.obj&&(this.obj.removeAllFlattenRegion(),this.obj._flattenRegions._hash={})},NPGIS3D.Layer.S3MLayer.prototype.removeFlattenRegion=function(e){if(this.obj){var t=this.obj.removeFlattenRegion(e);return this.obj._flattenRegions._hash[e]=null,t}},NPGIS3D.Layer.S3MLayer.prototype.setCustomClipBox=function(e,t,i){if(this.obj){var o={dimensions:new Cesium.Cartesian3(e.x,e.y,e.z),position:Cesium.Cartesian3.fromDegrees(t.lon,t.lat,t.h),clipMode:i};return this.obj.setCustomClipBox(o)}},NPGIS3D.Layer.S3MLayer.prototype.clearCustomClipBox=function(){this.obj&&this.obj.clearCustomClipBox()},NPGIS3D.Layer.S3MLayer.prototype.addEventListener=function(e,t){this.events[e]=t},NPGIS3D.Layer.S3MLayer.prototype.removeEventListener=function(e){this.events[e]=null,delete this.events[e]},NPGIS3D.inherits(NPGIS3D.Layer.S3MLayer,NPGIS3D.Layer),NPGIS3D.Overlay=function(e,t){"use strict";this._entity=new Cesium.Entity({show:!0,name:e}),this.events={},this._entity.overlay=this,this.optsValidation=function(e){!NPGIS3D.NPUtil.isObject(e)},this._setPosition=function(e){if(!NPGIS3D.NPUtil.isObject(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Point","参数 point 不正确!");var t=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat);this._entity.position=Cesium.Cartesian3.fromDegrees(t.lon,t.lat,e.h)}},NPGIS3D.Overlay.prototype.show=function(){this._entity.show=!0},NPGIS3D.Overlay.prototype.hide=function(){this._entity.show=!1},NPGIS3D.Overlay.prototype.setPosition=function(e){if(Cesium.defined(e)){var t=e.h;e=NPGIS3D.NPUtil.coordinateTransByBasemap(e.lon,e.lat),this._entity.position=Cesium.Cartesian3.fromDegrees(e.lon,e.lat,t)}},NPGIS3D.Overlay.prototype.getPosition=function(){var e=this._entity.position;if(Cesium.defined(e)){e=e.getValue();var t=Cesium.Cartographic.fromCartesian(e);return e=NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasemap(Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)),e.h=t.height,e}},NPGIS3D.Overlay.prototype.setDescription=function(e){this._entity.description=e},NPGIS3D.Overlay.prototype.addEventLinsener=function(e,t){this.events[e]=t},NPGIS3D.Overlay.prototype.removeEventLinsener=function(e){this.events[e]&&delete this.events[e]},NPGIS3D.Overlay.Point=function(e,t){"use strict";this._CESIUMTYPE="point",t=NPGIS3D.NPUtil.extend(t,{id:NPGIS3D.NPUtil.UUID(),color:Cesium.Color.RED,pixelSize:10,outlineColor:Cesium.Color.BLACK,outlineWidth:0,show:!0}),NPGIS3D.Overlay.call(this,"point"),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.PointGraphics(t)},NPGIS3D.Overlay.Point.prototype.setColor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].color=e)},NPGIS3D.Overlay.Point.prototype.getPixelsize=function(){var e=this._entity[this._CESIUMTYPE].pixelSize;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Point.prototype.setPixelsize=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].pixelSize=e)},NPGIS3D.Overlay.Point.prototype.setOutlinecolor=function(e){Cesium.defined(val)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPGIS3D.Overlay.Point.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Point.prototype.setOutlinewidth=function(e){Cesium.defined(val)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Point.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Point.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Point,NPGIS3D.Overlay),NPGIS3D.Overlay.Marker=function(e,t){"use strict";this._CESIUMTYPE="billboard",this.geometry=e;var i=function(){t=NPGIS3D.NPUtil.extend(t,{id:NPGIS3D.NPUtil.UUID(),image:NPGIS3D.getScriptLocation()+"/lib/Cesium/Assets/Textures/maki/grepin.png",isButtomCenter:!0,width:32,height:32});var e,i=t.image||NPGIS3D.getScriptLocation()+"/lib/Cesium/Assets/Textures/maki/grepin.png",o=t.width||32,r=t.height||32;return e={image:i,width:o,height:r},t.isButtomCenter&&(e.verticalOrigin=Cesium.VerticalOrigin.BOTTOM),e},o=function(){var e={};return t.labelText&&""!=t.labelText&&(e.text=t.labelText),t.labelColor&&(e.outlineColor=t.labelColor),t.labelFont&&(e.font=t.labelFont),t.labelPixelOffset&&(e.pixelOffset=t.labelPixelOffset),e},r=i();NPGIS3D.Overlay.call(this,"marker",t.id),this._setPosition(e),this._entity[this._CESIUMTYPE]=r,this._entity.label=o()},NPGIS3D.Overlay.Marker.prototype.getScale=function(){var e=this._entity[this._CESIUMTYPE].scale;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setScale=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].scale=e)},NPGIS3D.Overlay.Marker.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPGIS3D.Overlay.Marker.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPGIS3D.Overlay.Marker.prototype.getImage=function(){var e=this._entity[this._CESIUMTYPE].image;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setImage=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].image=e)},NPGIS3D.Overlay.Marker.prototype.getPosition=function(){var e=this._entity[this._CESIUMTYPE].position;if(Cesium.defined(e)){e=e.getValue();var t=Cesium.Cartographic.fromCartesian(e);return e=NPGIS3D.NPUtil.CoordinateHelper.coordinateFromBasema(Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)),e.h=t.height,e}},NPGIS3D.Overlay.Marker.prototype.setPosition=function(e){Cesium.defined(e)&&(e=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.lon,e.lat),this._entity[this._CESIUMTYPE].position=Cesium.Cartesian3.fromDegrees(e.lon,e.lat))},NPGIS3D.Overlay.Marker.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Marker.prototype.getHorizontalorigin=function(){var e=this._entity[this._CESIUMTYPE].horizontalOrigin;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setHorizontalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].horizontalOrigin=e)},NPGIS3D.Overlay.Marker.prototype.getVerticalorigin=function(){var e=this._entity[this._CESIUMTYPE].verticalOrigin;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setVerticalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].verticalOrigin=e)},NPGIS3D.Overlay.Marker.prototype.getWidth=function(){var e=this._entity[this._CESIUMTYPE].width;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setWidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].width=e)},NPGIS3D.Overlay.Marker.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Marker.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPGIS3D.Overlay.Marker.prototype.setLine=function(e,t){var i=function(){var t,i,o,r,n=[],a=e.paths.length,s=0,l=0;for(s=0;s<a;s++)for(t=e.paths[s],i=t.length,l=0;l<i;l++)o=t[l],r=NPGIS3D.NPCoordinate.coordinateTransByBasemap(o.lon,o.lat),"2D"===o.type?n.push(r.lon,r.lat):n.push(r.lon,r.lat,o.h);return n},o=i(),r=new Cesium.PolylineGraphics(t);r.positions=Cesium.Cartesian3.fromDegreesArrayHeights(o),this._entity.polyline=r},NPGIS3D.Overlay.Marker.prototype.setLabel=function(e,t){Cesium.defined(e)&&(this._entity.label.text=e),t&&(t.labelColor&&(this._entity.label.fillColor=t.labelColor),t.labelFont&&(this._entity.label.font=t.labelFont),t.labelPixelOffset&&(this._entity.label.pixelOffset=t.labelPixelOffset),t.horizontalOrigin&&(this._entity.label.horizontalOrigin=t.horizontalOrigin),t.verticalOrigin&&(this._entity.label.verticalOrigin=t.verticalOrigin),t.labelStyle&&(this._entity.label.style=t.labelStyle),t.outlineWidth&&(this._entity.label.outlineWidth=t.outlineWidth),t.outlineColor&&(this._entity.label.outlineColor=t.outlineColor))},NPGIS3D.inherits(NPGIS3D.Overlay.Marker,NPGIS3D.Overlay),NPGIS3D.Overlay.Label=function(e,t){"use strict";this._CESIUMTYPE="label",t=NPGIS3D.NPUtil.extend(t,{id:NPGIS3D.NPUtil.UUID(),text:"netposa",font:"24px SimSun",style:NPGIS3D.LabelStyle.FILL_AND_OUTLINE,show:!0,fillColor:NPGIS3D.Color.RED,outlineColor:NPGIS3D.Color.BLACK,outlineWidth:1,scale:1,eyeOffset:NPGIS3D.Size3D.ZERO,pixelOffset:NPGIS3D.Size.ZERO,horizontalOrigin:NPGIS3D.HorizontalOrigin.CENTER,verticalOrigin:NPGIS3D.VerticalOrigin.BOTTOM,heightReference:NPGIS3D.HeightReference.NONE}),NPGIS3D.Overlay.call(this,"label"),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.LabelGraphics(t)},NPGIS3D.Overlay.Label.prototype.getText=function(){var e=this._entity[this._CESIUMTYPE].text;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setText=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].text=e)},NPGIS3D.Overlay.Label.prototype.getFont=function(){var e=this._entity[this._CESIUMTYPE].font;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setFont=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].font=e)},NPGIS3D.Overlay.Label.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Label.prototype.getScale=function(){var e=this._entity[this._CESIUMTYPE].scale;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setScale=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].scale=e)},NPGIS3D.Overlay.Label.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Label.prototype.getHorizontalorigin=function(){var e=this._entity[this._CESIUMTYPE].horizontalOrigin;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setHorizontalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].horizontalOrigin=e)},NPGIS3D.Overlay.Label.prototype.getVerticalorigin=function(){var e=this._entity[this._CESIUMTYPE].verticalOrigin;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Label.prototype.setVerticalorigin=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].verticalOrigin=e)},NPGIS3D.Overlay.Label.prototype.setfillColor=function(e){this._entity[this._CESIUMTYPE].fillColor=e},NPGIS3D.Overlay.Label.prototype.setoutlineColor=function(e){this._entity[this._CESIUMTYPE].outlineColor=e},NPGIS3D.inherits(NPGIS3D.Overlay.Label,NPGIS3D.Overlay),NPGIS3D.Overlay.Polyline=function(e,t){"use strict";this._CESIUMTYPE="polyline";var i=!1;this.geometry=e,t=NPGIS3D.NPUtil.extend(t,{followSurface:!0,width:5,show:!0,material:Cesium.Color.RED,granularity:Cesium.Math.RADIANS_PER_DEGREE}),NPGIS3D.Overlay.call(this,"polyline");var o,r,n=function(){var t,o,r,n,a=[],s=e.paths.length,l=0,h=0;for(l=0;l<s;l++)for(t=e.paths[l],o=t.length,h=0;h<o;h++)r=t[h],n=NPGIS3D.NPCoordinate.coordinateTransByBasemap(r.lon,r.lat),"2D"===r.type?a.push(n.lon,n.lat):(a.push(n.lon,n.lat,r.h+.5),i||(i=!0));return a};if(!NPGIS3D.NPUtil.isArray(e.paths))throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Polyline","参数 polyline 不正确!");if(o=n(),!NPGIS3D.NPUtil.isArray(o)||o.length<4)throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Polyline","参数 positions 不正确!");r=new Cesium.PolylineGraphics(t),i?r.positions=Cesium.Cartesian3.fromDegreesArrayHeights(o):r.positions=Cesium.Cartesian3.fromDegreesArray(o),this._entity[this._CESIUMTYPE]=r},NPGIS3D.Overlay.Polyline.prototype.getWidth=function(){var e=this._entity[this._CESIUMTYPE].width;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polyline.prototype.setWidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].width=e)},NPGIS3D.Overlay.Polyline.prototype.getFollowsurface=function(){var e=this._entity[this._CESIUMTYPE].followSurface;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polyline.prototype.setFollowsurface=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].followSurface=e)},NPGIS3D.Overlay.Polyline.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polyline.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Polyline.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Polyline,NPGIS3D.Overlay),NPGIS3D.Overlay.Polygon=function(e,t){"use strict";this._CESIUMTYPE="polygon";var i=!1;this.geometry=e,t=NPGIS3D.NPUtil.extend(t,{perPositionHeight:!0,outlineColor:Cesium.Color.BLACK,material:Cesium.Color.RED}),NPGIS3D.Overlay.call(this,"polygon");var o,r,n=function(){var t,o,r,n,a=[],s=e.rings.length,l=0,h=0;for(l=0;l<s;l++)for(t=e.rings[l],o=t.length,h=0;h<o;h++)r=t[h],n=NPGIS3D.NPCoordinate.coordinateTransByBasemap(r.lon,r.lat),"point2D"===r.type?a.push(n.lon,n.lat):(a.push(n.lon,n.lat,r.h),i||(i=!0));return a};if(!NPGIS3D.NPUtil.isArray(e.rings))throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Polygon","参数 polygon 不正确!");if(o=n(),!NPGIS3D.NPUtil.isArray(o)||o.length<6)throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Polygon","参数 hierarchy 不正确!");r=new Cesium.PolygonGraphics(t),i?r.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(o):r.hierarchy=Cesium.Cartesian3.fromDegreesArray(o),this._entity[this._CESIUMTYPE]=r},NPGIS3D.Overlay.Polygon.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPGIS3D.Overlay.Polygon.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Polygon.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e)},NPGIS3D.Overlay.Polygon.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Polygon.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Polygon.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Polygon.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPGIS3D.Overlay.Polygon.prototype.getPerpositionheight=function(){var e=this._entity[this._CESIUMTYPE].perPositionHeight;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setPerpositionheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].perPositionHeight=e)},NPGIS3D.Overlay.Polygon.prototype.getClosetop=function(){var e=this._entity[this._CESIUMTYPE].closeTop;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setClosetop=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeTop=e)},NPGIS3D.Overlay.Polygon.prototype.getClosebottom=function(){var e=this._entity[this._CESIUMTYPE].closeBottom;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Polygon.prototype.setClosebottom=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeBottom=e)},NPGIS3D.Overlay.Polygon.prototype.setMaterial=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Polygon,NPGIS3D.Overlay),NPGIS3D.Overlay.Model=function(e,t){this._CESIUMTYPE="model",t=NPGIS3D.NPUtil.extend(t,{show:!0,scale:1}),NPGIS3D.Overlay.call(this,"model"),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.ModelGraphics(t)},NPGIS3D.Overlay.Model.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Model.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Model,NPGIS3D.Overlay),NPGIS3D.Overlay.Rectangle=function(e,t){if(this._CESIUMTYPE="rectangle",NPGIS3D.Overlay.call(this,"rectangle"),t=NPGIS3D.NPUtil.extend(t,{material:Cesium.Color.GREEN.withAlpha(.5),rotation:0,extrudedHeight:0,height:0,outline:!0,outlineColor:Cesium.Color.YELLOW,closeTop:!0,closeBottom:!0,show:!0,stRotation:0,fill:!0,granularity:Cesium.Math.RADIANS_PER_DEGREE}),this.optsValidation(t),!NPGIS3D.NPUtil.isObject(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Point","参数 extent 不正确!");e.left=e.xmin||e.left,e.bottom=e.ymin||e.bottom,e.right=e.xmax||e.right,e.top=e.ymax||e.top;var i=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.left,e.bottom),o=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e.right,e.top);t.coordinates=Cesium.Rectangle.fromDegrees(i.lon,i.lat,o.lon,o.lat),this._entity[this._CESIUMTYPE]=new Cesium.RectangleGraphics(t)},NPGIS3D.Overlay.Rectangle.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPGIS3D.Overlay.Rectangle.prototype.getClosetop=function(){var e=this._entity[this._CESIUMTYPE].closeTop;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setClosetop=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeTop=e)},NPGIS3D.Overlay.Rectangle.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e);
},NPGIS3D.Overlay.Rectangle.prototype.getClosebottom=function(){var e=this._entity[this._CESIUMTYPE].closeBottom;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setClosebottom=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].closeBottom=e)},NPGIS3D.Overlay.Rectangle.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Rectangle.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Rectangle.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Rectangle.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Rectangle.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPGIS3D.Overlay.Rectangle.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPGIS3D.Overlay.Rectangle.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Rectangle.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPGIS3D.Overlay.Rectangle.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Rectangle,NPGIS3D.Overlay),NPGIS3D.Overlay.Box=function(e,t){this._CESIUMTYPE="box",t=NPGIS3D.NPUtil.extend(t,{dimensions:Cesium.Cartesian3.ZERO,show:!0,fill:!0,outline:!1,outlineColor:Cesium.Color.BLACK,outlineWidth:1,material:Cesium.Color.GREEN}),NPGIS3D.Overlay.call(this,"box"),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.BoxGraphics(t)},NPGIS3D.Overlay.Box.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Box.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Box.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Box.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Box.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Box.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Box.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Box.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Box,NPGIS3D.Overlay),NPGIS3D.Overlay.Ellipsoid=function(e,t){if(NPGIS3D.Overlay.call(this),this._CESIUMTYPE="ellipsoid",NPGIS3D.Overlay.call(this,"ellipsoid"),t=NPGIS3D.NPUtil.extend(t,{radii:Cesium.Cartesian3.ZERO,material:Cesium.Color.GREEN,outline:!1,outlineColor:Cesium.Color.BLACK}),this.optsValidation(t),!NPGIS3D.NPUtil.isObject(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Overlay.Ellipsoid","参数 point 不正确!");this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.EllipsoidGraphics(t)},NPGIS3D.Overlay.Ellipsoid.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Ellipsoid.prototype.setOutlinecolor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getSubdivisions=function(){var e=this._entity[this._CESIUMTYPE].subdivisions;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setSubdivisions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].subdivisions=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getStackpartitions=function(){var e=this._entity[this._CESIUMTYPE].stackPartitions;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setStackpartitions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stackPartitions=e)},NPGIS3D.Overlay.Ellipsoid.prototype.getSlicepartitions=function(){var e=this._entity[this._CESIUMTYPE].slicePartitions;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipsoid.prototype.setSlicepartitions=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].slicePartitions=e)},NPGIS3D.Overlay.Ellipsoid.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Ellipsoid,NPGIS3D.Overlay),NPGIS3D.Overlay.Ellipse=function(e,t){this._CESIUMTYPE="ellipse",t=NPGIS3D.NPUtil.extend(t,{semiMinorAxis:15e4,semiMajorAxis:3e5,extrudedHeight:0,rotation:Cesium.Math.toRadians(0),material:Cesium.Color.BLUE.withAlpha(.5),outline:!0}),NPGIS3D.Overlay.call(this,"ellipse"),this._setPosition(e),this._entity[this._CESIUMTYPE]=new Cesium.EllipseGraphics(t)},NPGIS3D.Overlay.Ellipse.prototype.getHeight=function(){var e=this._entity[this._CESIUMTYPE].height;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setHeight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].height=e)},NPGIS3D.Overlay.Ellipse.prototype.getExtrudedheight=function(){var e=this._entity[this._CESIUMTYPE].extrudedHeight;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setExtrudedheight=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].extrudedHeight=e)},NPGIS3D.Overlay.Ellipse.prototype.getRotation=function(){var e=this._entity[this._CESIUMTYPE].rotation;if(Cesium.defined(e))return Cesium.Math.toDegrees(e.getValue())},NPGIS3D.Overlay.Ellipse.prototype.setRotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].rotation=Cesium.Math.toRadians(Number(e)))},NPGIS3D.Overlay.Ellipse.prototype.getSemiminoraxis=function(){var e=this._entity[this._CESIUMTYPE].semiMinorAxis;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setSemiminoraxis=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].semiMinorAxis=e)},NPGIS3D.Overlay.Ellipse.prototype.getSemimajoraxis=function(){var e=this._entity[this._CESIUMTYPE].semiMajorAxis;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setSemimajoraxis=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].semiMajorAxis=e)},NPGIS3D.Overlay.Ellipse.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Ellipse.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Ellipse.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Ellipse.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Ellipse.prototype.getNumberofverticallines=function(){var e=this._entity[this._CESIUMTYPE].numberOfVerticalLines;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setNumberofverticallines=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].numberOfVerticalLines=e)},NPGIS3D.Overlay.Ellipse.prototype.getStrotation=function(){var e=this._entity[this._CESIUMTYPE].stRotation;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Ellipse.prototype.setStrotation=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].stRotation=e)},NPGIS3D.Overlay.Ellipse.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Ellipse,NPGIS3D.Overlay),NPGIS3D.Overlay.Wall=function(e,t){this._CESIUMTYPE="wall";var i=[],o=[];t=t?t:{},t.height=t.height?t.height:10;for(var r=[],n=e.length-1;n>=0;n--)i.push(e[n].h+t.height),o.push(e[n].h),newPoint=NPGIS3D.NPCoordinate.coordinateTransByBasemap(e[n].lon,e[n].lat),r.push(newPoint);t=NPGIS3D.NPUtil.extend(t,{maximumHeights:i,minimumHeights:o,material:Cesium.Color.GREEN,outline:!0,outlineColor:Cesium.Color.RED}),NPGIS3D.Overlay.call(this,"wall");var a=new Cesium.WallGraphics(t);a.positions=NPGIS3D.NPCoordinate.fromNPCartesian3List(r),this._entity[this._CESIUMTYPE]=a},NPGIS3D.Overlay.Wall.prototype.getShow=function(){var e=this._entity[this._CESIUMTYPE].show;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Wall.prototype.setShow=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].show=e)},NPGIS3D.Overlay.Wall.prototype.getFill=function(){var e=this._entity[this._CESIUMTYPE].fill;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Wall.prototype.setFill=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].fill=e)},NPGIS3D.Overlay.Wall.prototype.getOutline=function(){var e=this._entity[this._CESIUMTYPE].outline;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Wall.prototype.setOutline=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outline=e)},NPGIS3D.Overlay.Wall.prototype.setOutlinecolor=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineColor=e)},NPGIS3D.Overlay.Wall.prototype.getOutlinewidth=function(){var e=this._entity[this._CESIUMTYPE].outlineWidth;if(Cesium.defined(e))return e.getValue()},NPGIS3D.Overlay.Wall.prototype.setOutlinewidth=function(e){Cesium.defined(e)&&(this._entity[this._CESIUMTYPE].outlineWidth=e)},NPGIS3D.Overlay.Wall.prototype.setMaterial=function(e){Cesium.defined(e)&&(e._?this._entity[this._CESIUMTYPE].material=e._:this._entity[this._CESIUMTYPE].material=e)},NPGIS3D.inherits(NPGIS3D.Overlay.Wall,NPGIS3D.Overlay),NPGIS3D.Overlay.InfoWindow=function(e,t,i,o){o=o||{infoSize:{h:"160px",w:""}};var r=window.document.createElement("div");r.className="ol-popup",t.viewer.scene.canvas.parentElement.parentElement.appendChild(r),"string"==typeof i?r.innerHTML=i:r.appendChild(i);var n=t.viewer;e=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(e.lon,e.lat,e.h);var a=t.getWindowCoordinates({x:e.lon,y:e.lat,z:e.h}),s=o.offset?o.offset:{x:0,y:0};r.style.left=a.x-50+s.x+"px",r.style.top=a.y-o.infoSize.h+s.y-11+"px",r.style.height=o.infoSize.h+"px",r.style.width=o.infoSize.w+"px",e=Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.h);var l=new Cesium.Entity({position:e,show:!1,point:{color:Cesium.Color.WHITE,outlineColor:Cesium.Color.RED,outlineWidth:1,pixelSize:6}});n.entities.add(l);var h=n.scene.postRender.addEventListener(function(){var e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.scene,l.position.getValue(Cesium.JulianDate.now()));try{r.style.left=a.x-50+s.x+"px",r.style.top=a.y-o.infoSize.h+s.y-22+"px",a=e}catch(t){}});this.show=function(){r.style.display=""},this.hide=function(){r.style.display="none"},this.getContainer=function(){return r},this.remove=function(){t.viewer.scene.canvas.parentElement.parentElement.removeChild(r),h.call(),n.entities.remove(l)}},NPGIS3D.inherits(NPGIS3D.Overlay.InfoWindow,NPGIS3D.Overlay),NPGIS3D.ModelLoader=function(e){this._viewer=e,this._collection=new Cesium.PrimitiveCollection,this._modelMap=new NPGIS3D.HashMap,this._viewer.viewer.camera.changed.addEventListener(this._cameraChangedHandler,this)},NPGIS3D.ModelLoader.prototype.loadModel=function(e,t){this._collection.add(this._getModel(e,t)),this._viewer.viewer.scene.groundPrimitives.add(this._collection)},NPGIS3D.ModelLoader.prototype.loadModels=function(e){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.ModelLoader","loadModels() 参数 modelArray 是必须项!");if(!NPGIS3D.NPUtil.isArray(e))throw new NPGIS3D.DeveloperError("NPGIS3D.ModelLoader","loadModels() 参数 modelArray 必须是数组!");var t,i=e.length-1;for(i;i>=0;i--)t=e[i],this._collection.add(this._getModel(t.url,t.position));this._viewer.viewer.scene.groundPrimitives.add(this._collection)},NPGIS3D.ModelLoader.prototype.removeAll=function(){this._collection.length>0&&this._collection.removeAll()},NPGIS3D.ModelLoader.prototype.show=function(){this._collection.show=!0},NPGIS3D.ModelLoader.prototype.hide=function(){this._collection.show=!1},NPGIS3D.ModelLoader.prototype.destroy=function(){this._viewer=null,this._collection=null},NPGIS3D.ModelLoader.prototype._cameraChangedHandler=function(){var e,t,i=this._viewer.viewer.camera.positionWC,o=0,r=this._collection.length,n=new Cesium.Cartesian3;for(this._collection.show||(this._collection.show=!0),o;o<r;o++)e=this._collection.get(o),n=Cesium.Matrix4.getTranslation(e.modelMatrix,n),t=Cesium.Cartesian3.distance(i,n),t<=1e3?e.show=!0:e.show=!1},NPGIS3D.ModelLoader.prototype._getModel=function(e,t){if(!Cesium.defined(e))throw new NPGIS3D.DeveloperError("NPGIS3D.ModelLoader","loadModel() 参数 url 是必须项!");if(!Cesium.defined(t))throw new NPGIS3D.DeveloperError("NPGIS3D.ModelLoader","loadModel() 参数 position 是必须项!");var i=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(t.lon,t.lat),o=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i.lon,i.lat,0)),r=Cesium.Model.fromGltf({url:e,modelMatrix:o,scale:40,show:!1});return r},NPGIS3D.DataSource=function(){"use strict"},NPGIS3D.DataSource.BuildingDataSource=function(e){"use strict";this.color=e.color?e.color:"#d9ccbe",this.fillAlpha=e.fillAlpha?e.fillAlpha:1,NPGIS3D.DataSource.call(this)},NPGIS3D.DataSource.BuildingDataSource.prototype.load=function(e,t){function i(){return r.get(e,{})}var o=new NPGIS3D.Promise,r=new NPGIS3D.HttpPromise,n=NPGIS3D.NPUtil.hexToRgb(this.color),a=this.fillAlpha,s=this;return i().then(function(e,i){var r,l,h,u,y,c,p,d,P=[];if(!e){if(""===i)return;for(r=JSON.parse(i),l=1,h=r.length;l<h;l++)u=r[l],y=s._getOpts(u),c=new Cesium.PolygonGeometry(y),p=new Cesium.GeometryInstance({geometry:c,id:u.id,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromBytes(n[0],n[1],n[2],255*a))}}),p.data=u,P.push(p);d=new Cesium.Primitive({geometryInstances:P,cull:!0,interleave:!0,appearance:new Cesium.PerInstanceColorAppearance({translucent:!1,faceForward:!0,closed:!1,renderState:{cull:{enabled:!0,face:1029}}})}),d.instances=P,o.done(!1,t,d)}}),o},NPGIS3D.DataSource.BuildingDataSource.prototype._getOpts=function(e){var t,i,o,r,n=e.polygon,a=n.positions.cartographicDegrees;if(!NPGIS3D.NPUtil.isArray(a)||a.length<=2)throw new NPGIS3D.DeveloperError("NPGIS3D.BuildingDataSource","参数 cartographicDegrees 不正确!"+e.id);return t=this._coordinateTransHeights(a),i=n.extrudedHeight,o=i.number,r={polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t)),perPositionHeight:!1,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,extrudedHeight:o},r.closeTop=!0,r.closeBottom=!1,r},NPGIS3D.DataSource.BuildingDataSource.prototype._coordinateTransHeights=function(e){var t,i,o,r,n,a=e.length,s=new Array;for(t=0;t<a;t+=3)i=e[t],o=e[t+1],r=e[t+2],n=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(i,o),s.push(n.lon),s.push(n.lat),s.push(r);return s},NPGIS3D.inherits(NPGIS3D.DataSource.BuildingDataSource,NPGIS3D.DataSource),NPGIS3D.DataSource.BuildingDataSourceEntity=function(e,t){"use strict";NPGIS3D.DataSource.call(this),this.color=t.color?t.color:"#f0ede5",this.fillAlpha=1,this._callback=e},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype.load=function(e,t){function i(){return r.get(e,{})}var o=new NPGIS3D.Promise,r=new NPGIS3D.HttpPromise,n=this,a=this;return i().then(function(e,i){var r,s,l,h,u,y,c,p;if(!e){for(r=JSON.parse(i),c=new Cesium.CustomDataSource("building_"+t),s=1,l=r.length;s<l;s++)h=r[s],u=h.polygon.positions.cartographicDegrees,y=n._coordinateTransHeights(u),p=n._getEntity(h,y),p.overlay=h,p.overlay._entity=p,p.overlay.events={},p.overlay.events.click=a._callback,c.entities.add(p);o.done(!1,t,c)}}),o},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getEntity=function(e,t){var i=new Cesium.Entity({id:"building_"+NPGIS3D.NPUtil.UUID()});return i.polygon=this._getPolygonGraphics(e,t),e.description=""!==e.description?e.description:"未命名",i.description="<span>名称："+e.description+"</span>",i},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getPolygonGraphics=function(e,t){var i=this._getPolygonOpts(e),o=new Cesium.PolygonGraphics(i);return o.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(t),o},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getWallGraphics=function(e){var t=NPGIS3D.NPUtil.hexToRgb(this.color),i=this.fillAlpha;return new Cesium.WallGraphics({positions:Cesium.Cartesian3.fromDegreesArrayHeights(e),material:Cesium.Color.fromBytes(t[0],t[1],t[2],255*i)})},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getTopGraphics=function(e,t){var i=this._getTopOpts(e),o=new Cesium.PolygonGraphics(i);return o.hierarchy=Cesium.Cartesian3.fromDegreesArrayHeights(t),o},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getPolygonOpts=function(e){var t,i=e.polygon,o=i.extrudedHeight,r=o.number,n=NPGIS3D.NPUtil.hexToRgb(this.color),a=this.fillAlpha;return t={id:e.id,perPositionHeight:!0,extrudedHeight:r,material:Cesium.Color.fromBytes(n[0],n[1],n[2],255*a),closeTop:!1,closeBottom:!0}},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._getTopOpts=function(e){var t,i=(e.polygon,NPGIS3D.NPUtil.hexToRgb(this.color)),o=this.fillAlpha;return t={height:50,material:Cesium.Color.fromBytes(i[0],i[1],i[2],255*o),closeTop:!1,closeBottom:!0}},NPGIS3D.DataSource.BuildingDataSourceEntity.prototype._coordinateTransHeights=function(e){var t,i,o,r,n,a=e.length,s=new Array;for(t=0;t<a;t+=3)i=e[t],o=e[t+1],r=e[t+2],n=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(i,o),s.push(n.lon),s.push(n.lat),s.push(r);return s},NPGIS3D.inherits(NPGIS3D.DataSource.BuildingDataSourceEntity,NPGIS3D.DataSource),NPGIS3D.Building.LoadBuilding=function(e,t,i){"use strict";this._url=t,this._events={},this._visiblity=!0,this._viewer=e,this._T_C_DISTANCE=i&&i.maxDistance?i.maxDistance:3e3,this._CAMERA_HEIGHT=i&&i.maxHeight?i.maxHeight:5e3,this.ORIGIN_LON=-180,this._isLoad=!1,this.ORIGIN_LAT=90,this.MAP_LEVEL=16,this.coef=360/Math.pow(2,this.MAP_LEVEL),this.hashMap=new NPGIS3D.HashMap,this.camera=this._viewer.viewer.camera,this.scene=this._viewer.viewer.scene,this.ellipsoid=this._viewer.viewer.scene.globe.ellipsoid,this.isInteraction=!1,this._extent=i&&i.extent?i.extent:new NPGIS3D.Geometry.Extent(73.55,3.85,135.08333333333334,53.55),this._boundExtent=this._getBound(),this.color=i&&i.color?i.color:"#f0ede5",this.fillAlpha=i&&i.fillAlpha?i.fillAlpha:1},NPGIS3D.Building.LoadBuilding.prototype.addEventListener=function(e,t){"click"===e&&(this._clearAll(),this.isInteraction=!0,this._events.click=t,this._isLoad&&this._loadBuildingData())},NPGIS3D.Building.LoadBuilding.prototype.removeEventListener=function(e){"click"===e&&(this._events.click=null,this._clearAll(),this.removeHandler&&this.removeHandler.call(),this.isInteraction=!1,this._loadBuildingData())},NPGIS3D.Building.LoadBuilding.prototype.load=function(){var e=this;this._isLoad=!0,this.camera.changed.addEventListener(this._loadBuildingData,this),this._loadBuildingData();var t=new Cesium.ScreenSpaceEventHandler(this.scene.canvas);t.setInputAction(function(t){var i=e.scene.pick(t.position);Cesium.defined(i)&&console.log(i.id)},Cesium.ScreenSpaceEventType.LEFT_CLICK)},NPGIS3D.Building.LoadBuilding.prototype.show=function(){this._visiblity=!0,this._isLoad&&this._loadBuildingData()},NPGIS3D.Building.LoadBuilding.prototype.hide=function(){this._visiblity=!1,this._clearAll()},NPGIS3D.Building.LoadBuilding.prototype.destory=function(){this._visiblity=!1,this._clearAll(),this.camera.changed.removeEventListener(this._loadBuildingData,this)},NPGIS3D.Building.LoadBuilding.prototype._clearAll=function(){this.isInteraction?this._remoreBuildingDs():this._remoreBuildingPt(),this.hashMap.clear()},NPGIS3D.Building.LoadBuilding.prototype._loadBuildingData=function(){if(this._visiblity&&!(this.camera.pitch/3.1415926*180>-9)){var e,t,i,o,r,n,a=this.ellipsoid.cartesianToCartographic(this.camera.position).height;if(a>this._CAMERA_HEIGHT)return void this._clearAll();e=this._cameraCenterToWebMoctor(),t=this._cameraViewRectToTileScope(),i=t.minRow,o=t.maxRow,r=t.minCol,n=t.maxCol,this.hashMap=this._remove(i,o,r,n),this._loadBuildingTiles(i,o,r,n,e)}},NPGIS3D.Building.LoadBuilding.prototype._remoreBuildingDs=function(){var e,t=this.hashMap.values(),i=t.length;for(e=0;e<i;e++)this._viewer.viewer.dataSources.remove(t[e].dataSource,!0)},NPGIS3D.Building.LoadBuilding.prototype._remoreBuildingPt=function(){var e,t=this.hashMap.values(),i=t.length;for(e=0;e<i;e++)this._viewer.viewer.scene.primitives.remove(t[e].dataSource,!0)},NPGIS3D.Building.LoadBuilding.prototype._loadBuildingTiles=function(e,t,i,o,r){var n,a,s,l;for(n=e;n<t+1;n++)for(a=i;a<o+1;a++)this._isRequestTile(n,a,r)&&(s=this.MAP_LEVEL+"_"+n+"_"+a,l=this._url+"/"+s+".czml",this.hashMap.containsKey(s)||(this.isInteraction?this._loadBuildingTileForEntity(l,s):this._loadBuildingTile(l,s)))},NPGIS3D.Building.LoadBuilding.prototype._isRequestTile=function(e,t,i){var o=!0,r=e*this.coef+this.ORIGIN_LON,n=(e+1)*this.coef+this.ORIGIN_LON,a=this.ORIGIN_LAT-(t+1)*this.coef,s=this.ORIGIN_LAT-t*this.coef,l=_3dhelper.degreeToWebMoctor((r+n)/2,(a+s)/2),h=Math.sqrt(Math.pow(i.lon-l.lon,2)+Math.pow(i.lat-l.lat,2));return(h>this._T_C_DISTANCE||!this._isInBoundExtent(e,t))&&(o=!1),o},NPGIS3D.Building.LoadBuilding.prototype._isInBoundExtent=function(e,t){var i=!0;return(e<this._boundExtent.minRow||e>this._boundExtent.maxRow||t<this._boundExtent.minCol||t>this._boundExtent.maxCol)&&(i=!1),i},NPGIS3D.Building.LoadBuilding.prototype._getBound=function(){var e={minRow:0,maxRow:0,minCol:0,maxCol:0},t=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(this._extent.xmin,this._extent.ymax),i=NPGIS3D.NPUtil.CoordinateHelper.coordinateTransByBasemap(this._extent.xmax,this._extent.ymin),o=t.lon,r=t.lat,n=i.lon,a=i.lat;return e.minRow=Math.floor((o-this.ORIGIN_LON)/this.coef),e.maxRow=Math.ceil((n-this.ORIGIN_LON)/this.coef),e.minCol=Math.floor((this.ORIGIN_LAT-r)/this.coef),e.maxCol=Math.ceil((this.ORIGIN_LAT-a)/this.coef),e},NPGIS3D.Building.LoadBuilding.prototype._loadBuildingTile=function(e,t){function i(){return r.load(e,t)}var o=new NPGIS3D.Promise,r=new NPGIS3D.DataSource.BuildingDataSource({color:this.color,fillAlpha:this.fillAlpha}),n=this;o.when([i()]).then(function(e){var t,i,o,r;t=e[0],i=t[1],o=t[2],o.key=i;for(var a=0;a<n.scene.primitives.length;a++)if(n.scene.primitives.get(a).key===i)return;n.scene.primitives.add(o),r={dataSource:o,state:!1},n.hashMap.put(i,r),o=null})},NPGIS3D.Building.LoadBuilding.prototype._loadBuildingTileForEntity=function(e,t){function i(){return r.load(e,t)}var o=new NPGIS3D.Promise,r=new NPGIS3D.DataSource.BuildingDataSourceEntity(this._events.click,{color:this.color,fillAlpha:this.fillAlpha}),n=this;o.when([i()]).then(function(e){var t,i=e[0],o=i[1],r=i[2];r.key=o;for(var a=0;a<n._viewer.viewer.dataSources.length;a++)if(n._viewer.viewer.dataSources.get(a).key===o)return;n._viewer.viewer.dataSources.add(r),t={dataSource:r,state:!1},n.hashMap.put(o,t)})},NPGIS3D.Building.LoadBuilding.prototype._cameraCenterToWebMoctor=function(){var e=this.camera.positionWC,t=this.ellipsoid.cartesianToCartographic(e),i=(this.ellipsoid.cartographicToCartesian(t),Cesium.Math.toDegrees(t.longitude)),o=Cesium.Math.toDegrees(t.latitude);return _3dhelper.degreeToWebMoctor(i,o)},NPGIS3D.Building.LoadBuilding.prototype._cameraViewRectToTileScope=function(){var e={minRow:0,maxRow:0,minCol:0,maxCol:0},t=new Cesium.Rectangle,i=this.camera.computeViewRectangle(Cesium.Ellipsoid.WGS84,t),o=Cesium.Math.toDegrees(i.west),r=Cesium.Math.toDegrees(i.north),n=Cesium.Math.toDegrees(i.east),a=Cesium.Math.toDegrees(i.south),s=Math.floor((o-this.ORIGIN_LON)/this.coef),l=Math.ceil((n-this.ORIGIN_LON)/this.coef),h=Math.floor((this.ORIGIN_LAT-a)/this.coef),u=Math.ceil((this.ORIGIN_LAT-r)/this.coef),y=1;return l-s<4&&(y=2),s-=y,l+=y,u-=y,h+=y,e.minRow=s,e.maxRow=l,e.minCol=u,e.maxCol=h,e},NPGIS3D.Building.LoadBuilding.prototype._remove=function(e,t,i,o){var r,n,a,s,l=new NPGIS3D.HashMap,h=this.hashMap.keys();for(r=e;r<t+1;r++)for(n=i;n<o+1;n++){a=this.MAP_LEVEL+"_"+r+"_"+n;var u=this._cameraCenterToWebMoctor(),y=r*this.coef+this.ORIGIN_LON,c=(r+1)*this.coef+this.ORIGIN_LON,p=this.ORIGIN_LAT-(n+1)*this.coef,d=this.ORIGIN_LAT-n*this.coef,P=_3dhelper.degreeToWebMoctor((y+c)/2,(p+d)/2),m=Math.sqrt(Math.pow(u.lon-P.lon,2)+Math.pow(u.lat-P.lat,2));m>this._T_C_DISTANCE&&this.hashMap.containsKey(a)&&(this.hashMap.get(a).state=!1),this.hashMap.containsKey(a)&&(this.hashMap.get(a).state=!0)}for(r=h.length-1;r>=0;r--)s=h[r],this.hashMap.get(s).state?(this.hashMap.get(s).state=!1,l.put(s,this.hashMap.get(s))):this.isInteraction?this._viewer.viewer.dataSources.remove(this.hashMap.get(s).dataSource):this.scene.primitives.remove(this.hashMap.get(s).dataSource);return l},NPGIS3D.Trajectory=function(e){"use strict";this.camera=new NPGIS3D.Camera(e)},NPGIS3D.Trajectory.prototype.play=function(e,t){this.camera.trackDrive(e,t)},NPGIS3D.Trajectory.prototype.stop=function(){this.camera.stopTrack()},NPGIS3D.Tools=NPGIS3D.Tools||{},NPGIS3D.Tools.DrawingTool=function(e,t){this._viewer=e.viewer},NPGIS3D.Tools.DrawingTool.prototype.setMode=function(e,t,i){var o=Cesium.DrawMode.Point;switch(e){case NPGIS3D.DrawingMode.MARKER:o=Cesium.DrawMode.Marker;break;case NPGIS3D.DrawingMode.POLYLINE:o=Cesium.DrawMode.Line;break;case NPGIS3D.DrawingMode.POLYGON:o=Cesium.DrawMode.Polygon;break;default:return void this.drawClean()}this._handler&&(this._handler.clear(),this._handler.deactivate()),this._handler=new Cesium.DrawHandler(this._viewer,o,0);var r=this;this._handler.drawEvt.addEventListener(function(e){var i;if(o==Cesium.DrawMode.Line){for(var n=NPGIS3D.NPCoordinate.positionsToPolylineGeo(e.object.positions),a=0;a<n.paths[0].length;a++)n.paths[0][a].h<0&&(n.paths[0][a].h=0);i=new NPGIS3D.Overlay.Polyline(n),r._handler.clear()}else if(o==Cesium.DrawMode.Polygon){for(var s=NPGIS3D.NPCoordinate.positionsToPolygonGeo(e.object.positions),a=0;a<s.rings[0].length;a++)s.rings[0][a].h<0&&(s.rings[0][a].h=0);i=new NPGIS3D.Overlay.Polygon(s),r._handler.polygon.show=!1,r._handler.polyline.show=!1}else if(o==Cesium.DrawMode.Marker){var l=NPGIS3D.NPCoordinate.cartesianToPointGeo(e.object.position);l.h<0&&(l.h=0),r._handler.clear(),i=l}t(i)}),this._handler.activeEvt.addEventListener(function(e){1==e?(r._viewer.enableCursorStyle=!1,r._viewer._element.style.cursor="crosshair"):(r._viewer._element.style.cursor="",r._viewer.enableCursorStyle=!0)}),this._handler.activate()},NPGIS3D.Tools.DrawingTool.prototype.drawClean=function(){this._handler&&(this._handler.deactivate(),this._handler.clear())},NPGIS3D.Tools.DrawingTool.prototype.drawCircle=function(e,t){var i=this;this._drawHelper.startDrawingCircle({callback:function(t){var o,r=t.center,n=t.radius,a=t.scene,s=new DrawHelper.CirclePrimitive({center:r,radius:n,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(o=new NPGIS3D.Geometry.Circle(NPGIS3D.NPCoordinate.cartesianToPointGeo(r),n),e(o)),a.primitives.add(s),i._drawCollection.add(s),s.setEditable(),s.addListener("onEdited",function(t){"function"==typeof e&&(o=new NPGIS3D.Geometry.Circle(NPGIS3D.NPCoordinate.cartesianToPointGeo(t.center),t.radius),e(o))})}})},NPGIS3D.Tools.DrawingTool.prototype.drawExtent=function(e,t){var i=this;this._drawHelper.startDrawingExtent({callback:function(t){var o,r=t.extent,n=t.scene,a=new DrawHelper.ExtentPrimitive({extent:r,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(o=NPGIS3D.NPCoordinate.extentToExtentGeo(r),e(o)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){"function"==typeof e&&(o=NPGIS3D.NPCoordinate.extentToExtentGeo(t.extent),e(o))})}})},NPGIS3D.Tools.DrawingTool.prototype.drawPolygon=function(e,t){var i=this;this._drawHelper.startDrawingPolygon({callback:function(t){var o,r=t.positions,n=t.scene,a=new DrawHelper.PolygonPrimitive({positions:r,material:Cesium.Material.fromType(Cesium.Material.RimLightingType)});"function"==typeof e&&(o=NPGIS3D.NPCoordinate.positionsToPolygonGeo(r),e(o)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){r=t.positions,"function"==typeof e&&(o=NPGIS3D.NPCoordinate.positionsToPolygonGeo(r),e(o))})}})},NPGIS3D.Tools.DrawingTool.prototype.drawPolyline=function(e,t){var i=this;this._drawHelper.startDrawingPolyline({callback:function(t){var o,r=t.positions,n=t.scene,a=new DrawHelper.PolylinePrimitive({positions:r,width:5,material:Cesium.Material.fromType(Cesium.Material.RimLightingType),geodesic:!0});"function"==typeof e&&(o=NPGIS3D.NPCoordinate.positionsToPolylineGeo(r),e(o)),n.primitives.add(a),i._drawCollection.add(a),a.setEditable(),a.addListener("onEdited",function(t){r=t.positions,"function"==typeof e&&(o=NPGIS3D.NPCoordinate.positionsToPolylineGeo(r),e(o))})}})},NPGIS3D.Tools.DrawingTool.prototype.drawMarker=function(e,t){var i=this;this._drawHelper.startDrawingMarker({callback:function(t){var o,r=t.position,n=t.scene,a=new Cesium.BillboardCollection;"function"==typeof e&&(o=NPGIS3D.NPCoordinate.cartesianToPointGeo(r),e(o)),n.primitives.add(a);var s=NPGIS3D.NPUtil.getHost()+"lib/Cesium/Assets",l=a.add({show:!0,position:r,pixelOffset:new Cesium.Cartesian2(0,0),eyeOffset:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,scale:1,image:s+"/img/glyphicons_242_google_maps.png",color:new Cesium.Color(1,1,1,1)});i._drawCollection.add(a),l.setEditable(),l.addListener("dragEnd",function(t){r=t.positions,"function"==typeof e&&(o=NPGIS3D.NPCoordinate.cartesianToPointGeo(r),e(o))})}})},NPGIS3D.DrawingMode={
MARKER:"drawMarker",POLYLINE:"drawPolyline",POLYGON:"drawPolygon",CIRCLE:"drawCircle",EXTENT:"drawExtent",CLEAN:"clean"},NPGIS3D.Tools=NPGIS3D.Tools||{},NPGIS3D.Tools.MeasureTool=function(e,t){this.viewer=e.viewer},NPGIS3D.Tools.MeasureTool.prototype.setMode=function(e,t){var i=Cesium.MeasureMode.Area;switch(e){case NPGIS3D.MeasureMode.AREA:i=Cesium.MeasureMode.Area;break;case NPGIS3D.MeasureMode.DISTANCE:i=Cesium.MeasureMode.Distance;break;case NPGIS3D.MeasureMode.HEIGHT:case NPGIS3D.MeasureMode.DVH:i=Cesium.MeasureMode.DVH;break;default:return void this.measureClean()}this._handler&&(this._handler.deactivate(),this._handler.clear()),this._handler=new Cesium.MeasureHandler(this.viewer,i);var o=this;this._handler.measureEvt.addEventListener(function(e){if(i==Cesium.MeasureMode.Distance){var t=e.distance>1e3?e.distance/1e3+"km":e.distance+"m";o._handler.disLabel.text="距离:"+t,o._handler.disLabel.outlineColor=new Cesium.Color(0,0,1,.9),o._handler.disLabel.font="100 20px 宋体",o._handler.disLabel.outlineWidth=5,o._handler.disLabel.showBackground=!1}else if(i==Cesium.MeasureMode.Area){var r=e.area>1e6?e.area/1e6+"km²":e.area+"㎡";o._handler.areaLabel.text="面积:"+r,o._handler.areaLabel.outlineColor=new Cesium.Color(0,0,1,.9),o._handler.areaLabel.font="100 20px 宋体",o._handler.areaLabel.outlineWidth=5,o._handler.areaLabel.showBackground=!1}else if(i==Cesium.MeasureMode.DVH||i==Cesium.measureModel.HEIGHT){var t=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",n=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",a=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";o._handler.disLabel.text="空间距离:"+t,o._handler.disLabel.outlineColor=new Cesium.Color(0,0,1,.9),o._handler.disLabel.font="100 20px 宋体",o._handler.disLabel.outlineWidth=5,o._handler.vLabel.text="垂直高度:"+n,o._handler.vLabel.outlineColor=new Cesium.Color(0,0,1,.9),o._handler.vLabel.font="100 20px 宋体",o._handler.vLabel.outlineWidth=5,o._handler.hLabel.text="水平距离:"+a,o._handler.hLabel.outlineColor=new Cesium.Color(0,0,1,.9),o._handler.hLabel.font="100 20px 宋体",o._handler.hLabel.outlineWidth=5}}),this._handler.activeEvt.addEventListener(function(e){1==e?(o.viewer.enableCursorStyle=!1,o.viewer._element.style.cursor="crosshair"):(o.viewer._element.style.cursor="",o.viewer.enableCursorStyle=!0)}),this._handler.activate()},NPGIS3D.Tools.MeasureTool.prototype.measureDistance=function(e){this.drawHelper.measureDistance(e)},NPGIS3D.Tools.MeasureTool.prototype.measureArea=function(e){this.drawHelper.measureArea(e)},NPGIS3D.Tools.MeasureTool.prototype.measureClean=function(){this._handler&&(this._handler.deactivate(),this._handler.clear())},NPGIS3D.MeasureMode={DISTANCE:"measureDistance",AREA:"measureArea",HEIGHT:"height",DVH:"DVH",CLEAN:"measureClean"},NPGIS3D.PolylineArrowMaterialProperty=function(e){this._=new Cesium.PolylineArrowMaterialProperty(e||Cesium.Color.WHITE)},NPGIS3D.PolylineOutlineMaterialProperty=function(e){e=e||{color:Cesium.Color.WHITE,outlineColor:Cesium.Color.BLACK,outlineWidth:1},this._=new Cesium.PolylineOutlineMaterialProperty(e)},NPGIS3D.Tile3DLoader=function(e){this._viewer=e,this._collection=[]},NPGIS3D.Tile3DLoader.prototype.loadTile3D=function(e){var t=map.viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:e,debugShowStatistics:!0,maximumNumberOfLoadedTiles:3}));this._collection.push(t)},NPGIS3D.Tile3DLoader.prototype.loadTile3Ds=function(e){if(!NPGIS3D.NPUtil.isArray(e))throw new NPGIS3D.DeveloperError("NPGIS3D.Tile3DLoader","loadTile3Ds() 参数 urls 必须是数组!");var t,i=e.length-1;for(i;i>=0;i--)t=e[i],this.loadTile3D(t)},NPGIS3D.Tile3DLoader.prototype.removeAll=function(){for(var e=0;e<this._collection.length;e++)this._collection[e].destroy()},NPGIS3D.Tile3DLoader.prototype.show=function(){for(var e=0;e<this._collection.length;e++)this._collection[e].show(!0)},NPGIS3D.Tile3DLoader.prototype.hide=function(){for(var e=0;e<this._collection.length;e++)this._collection[e].show(!1)},NPGIS3D.Tile3DLoader.prototype.destroy=function(){this.removeAll(),this._viewer=null,this._collection=null},NPGIS3D.SightLine=function(e,t){"use strict";this.scene=e.viewer.scene,this._viewer=e},NPGIS3D.SightLine.prototype.init=function(e){this._obj=new Cesium.Sightline(this.scene),e&&(e.hiddenColor&&(this._obj.hiddenColor=e.hiddenColor),e.visibleColor&&(this._obj.visibleColor=e.visibleColor))},NPGIS3D.SightLine.prototype.setCouldRemove=function(e){this._obj&&(this._obj.couldRemove=e)},NPGIS3D.SightLine.prototype.build=function(){this._obj&&this._obj.build()},NPGIS3D.SightLine.prototype.removeAllTargetPoint=function(){this._obj&&this._obj.removeAllTargetPoint()},NPGIS3D.SightLine.prototype.setViewPosition=function(e){this._obj&&(this._obj.viewPosition=[e.lon,e.lat,e.h])},NPGIS3D.SightLine.prototype.addTargetPoint=function(e,t){return!!this._obj&&this._obj.addTargetPoint({position:[e.lon,e.lat,e.h],name:t})},NPGIS3D.SightLine.prototype.removeTargetPoint=function(e){if(this._obj)return this._obj.removeTargetPoint(e)},NPGIS3D.SightLine.prototype.update=function(){if(this._obj)return this._obj.update()};